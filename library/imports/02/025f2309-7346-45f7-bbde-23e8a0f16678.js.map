{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\NiuNiu\\script/assets\\NiuNiu\\script\\GameMgr.js"],"names":["Toast","require","dataMgr","getInstance","cc","Class","extends","Component","properties","onLoad","GlobalNiuNiu","gameMgr","start","listenEvent","eventMgr","on","config","EVENT_NETWORK_OPENED","onNetOpen","EVENT_NETWORK_CLOSED","onNetClosed","EVENT_LOGIN_SUC","onLoginSuc","EVENT_LOGIN_FAILED","onLoginFailed","event","log","connectState","netProxy","login","showText","scheduleOnce","dt","isNetworkOpened","connect","resp","uid","playerObj","parse","saveDataToLocal","startBeatHeart","schedule","checkInternet","t","Date","now","beatHeart","JSON","stringify","onOpenRoom","err","loadScene","setTimeout","emit","EVENT_OPEN_ROOM","onEnterRoom","EVENT_ENTER_ROOM"],"mappings":";;;;AAAA;;;;AAIA;;AAEA,IAAIA,QAAQC,QAAQ,mBAAR,CAAZ;AACA,IAAIC,UAAUD,QAAQ,kBAAR,EAA4BE,WAA5B,EAAd;;AAEAC,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY,EAHP;;AAKLC,UALK,oBAKG;AACJC,qBAAaC,OAAb,GAAuB,IAAvB;AACH,KAPI;AASLC,SATK,mBASE;AACH,aAAKC,WAAL;AACH,KAXI;AAaLA,eAbK,yBAaQ;AACTH,qBAAaI,QAAb,CAAsBC,EAAtB,CAAyBL,aAAaM,MAAb,CAAoBC,oBAA7C,EAAmE,KAAKC,SAAxE,EAAmF,IAAnF;AACAR,qBAAaI,QAAb,CAAsBC,EAAtB,CAAyBL,aAAaM,MAAb,CAAoBG,oBAA7C,EAAmE,KAAKC,WAAxE,EAAqF,IAArF;AACAV,qBAAaI,QAAb,CAAsBC,EAAtB,CAAyBL,aAAaM,MAAb,CAAoBK,eAA7C,EAA8D,KAAKC,UAAnE,EAA+E,IAA/E;AACAZ,qBAAaI,QAAb,CAAsBC,EAAtB,CAAyBL,aAAaM,MAAb,CAAoBO,kBAA7C,EAAiE,KAAKC,aAAtE,EAAqF,IAArF;AACH,KAlBI;AAoBLN,aApBK,qBAoBKO,KApBL,EAoBW;AACZrB,WAAGsB,GAAH,CAAO,aAAP;AACA;AACAhB,qBAAaiB,YAAb,GAA4B,IAA5B;AACAjB,qBAAakB,QAAb,CAAsBC,KAAtB,CAA4B,CAA5B;AACH,KAzBI;AA2BLT,eA3BK,uBA2BOK,KA3BP,EA2Ba;AACdrB,WAAGsB,GAAH,CAAO,uBAAP;AACA1B,cAAM8B,QAAN,CAAe,cAAf,EAA+B,CAA/B;AACApB,qBAAaiB,YAAb,GAA4B,KAA5B;AACA,aAAKI,YAAL,CAAkB,UAACC,EAAD,EAAM;AACpB,gBAAI,CAACtB,aAAakB,QAAb,CAAsBK,eAAtB,EAAL,EAA6C;AACzCvB,6BAAakB,QAAb,CAAsBM,OAAtB;AACH;AACJ,SAJD,EAIG,CAJH;AAMH,KArCI;AAuCLZ,cAvCK,sBAuCMG,KAvCN,EAuCY;AACb,YAAIU,OAAOV,KAAX;AACArB,WAAGsB,GAAH,CAAO,OAAP;AACAtB,WAAGsB,GAAH,CAAOD,KAAP;AACA,YAAIU,KAAKC,GAAL,IAAY,IAAhB,EAAqB;AACjBlC,oBAAQmC,SAAR,CAAkBC,KAAlB,CAAwBH,IAAxB;AACAjC,oBAAQqC,eAAR;AACH;AACJ,KA/CI;AAiDLf,iBAjDK,yBAiDSC,KAjDT,EAiDe;AAChBrB,WAAGsB,GAAH,CAAO,cAAP;AACA,aAAKK,YAAL,CAAkB,UAACC,EAAD,EAAM;AACpBtB,yBAAakB,QAAb,CAAsBC,KAAtB,CAA4B,CAA5B;AACH,SAFD,EAEG,CAFH;AAGH,KAtDI;AAwDLW,kBAxDK,4BAwDW;AAAA;;AACZ,aAAKC,QAAL,CAAc,UAACT,EAAD,EAAM;AAChB,gBAAI,CAAC,MAAKU,aAAL,EAAL,EAA2B;AAC3B,gBAAIC,IAAIC,KAAKC,GAAL,EAAR;AACAnC,yBAAakB,QAAb,CAAsBkB,SAAtB,CAAgC,UAACX,IAAD,EAAQ;AACpC/B,mBAAGsB,GAAH,CAAOqB,KAAKC,SAAL,CAAeb,IAAf,CAAP;AACA/B,mBAAGsB,GAAH,CAAO,aAAaS,KAAKQ,CAAL,GAASA,CAAtB,CAAP;AACH,aAHD;AAIH,SAPD,EAOG,CAPH;AAQH,KAjEI;AAmELD,iBAnEK,2BAmEU;AACX,eAAOhC,aAAakB,QAAb,CAAsBK,eAAtB,EAAP;AACH,KArEI;AAuELgB,cAvEK,sBAuEMd,IAvEN,EAuEW;AACZ,YAAIA,KAAKe,GAAL,GAAW,CAAf,EAAiB;AACblD,kBAAM8B,QAAN,CAAe,OAAf,EAAwB,CAAxB;AACA;AACH;AACDpB,qBAAayC,SAAb,CAAuB,SAAvB,EAAiC,YAAI;AACjCC,uBAAW,YAAI;AACX1C,6BAAaI,QAAb,CAAsBuC,IAAtB,CAA2B3C,aAAaM,MAAb,CAAoBsC,eAA/C,EAAgEnB,IAAhE;AACH,aAFD,EAEE,IAFF;AAGH,SAJD;AAKH,KAjFI;AAmFLoB,eAnFK,uBAmFOpB,IAnFP,EAmFY;AACb,YAAIA,KAAKe,GAAL,GAAW,CAAf,EAAiB;AACblD,kBAAM8B,QAAN,CAAe,cAAf,EAA+B,CAA/B;AACA;AACH;AACDpB,qBAAayC,SAAb,CAAuB,SAAvB,EAAiC,YAAI;AACjCC,uBAAW,YAAI;AACX1C,6BAAaI,QAAb,CAAsBuC,IAAtB,CAA2B3C,aAAaM,MAAb,CAAoBwC,gBAA/C,EAAiErB,IAAjE;AACH,aAFD,EAEE,IAFF;AAGH,SAJD;AAKH;AA7FI,CAAT","file":"GameMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\NiuNiu\\script","sourcesContent":["/**\n * Created by skyxu on 2019/3/28.\n */\n\n\"use strict\";\n\nlet Toast = require(\"./views/ToastCtrl\");\nlet dataMgr = require(\"./common/DataMgr\").getInstance();\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {},\n\n    onLoad(){\n        GlobalNiuNiu.gameMgr = this;\n    },\n\n    start(){\n        this.listenEvent();\n    },\n\n    listenEvent(){\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_NETWORK_OPENED, this.onNetOpen, this);\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_NETWORK_CLOSED, this.onNetClosed, this);\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_LOGIN_SUC, this.onLoginSuc, this);\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_LOGIN_FAILED, this.onLoginFailed, this);\n    },\n\n    onNetOpen(event){\n        cc.log(\"net opened.\");\n        // this.startBeatHeart();\n        GlobalNiuNiu.connectState = true;\n        GlobalNiuNiu.netProxy.login(0);\n    },\n\n    onNetClosed(event){\n        cc.log(\"net closed. 5s 后重试连接.\");\n        Toast.showText(\"网络连接失败，正在重试.\", 2);\n        GlobalNiuNiu.connectState = false;\n        this.scheduleOnce((dt)=>{\n            if (!GlobalNiuNiu.netProxy.isNetworkOpened()){\n                GlobalNiuNiu.netProxy.connect();\n            }\n        }, 5);\n\n    },\n\n    onLoginSuc(event){\n        let resp = event;\n        cc.log(\"登陆成功.\");\n        cc.log(event)\n        if (resp.uid != null){\n            dataMgr.playerObj.parse(resp);\n            dataMgr.saveDataToLocal();\n        }\n    },\n\n    onLoginFailed(event){\n        cc.log(\"登陆失败. 5s后重试.\");\n        this.scheduleOnce((dt)=>{\n            GlobalNiuNiu.netProxy.login(0);\n        }, 5)\n    },\n\n    startBeatHeart(){\n        this.schedule((dt)=>{\n            if (!this.checkInternet()) return;\n            let t = Date.now();\n            GlobalNiuNiu.netProxy.beatHeart((resp)=>{\n                cc.log(JSON.stringify(resp));\n                cc.log(\"delay: \" + (resp.t - t));\n            });\n        }, 5);\n    },\n\n    checkInternet(){\n        return GlobalNiuNiu.netProxy.isNetworkOpened();\n    },\n\n    onOpenRoom(resp){\n        if (resp.err > 0){\n            Toast.showText(\"开房失败.\", 2);\n            return;\n        }\n        GlobalNiuNiu.loadScene(\"RoomNet\",()=>{\n            setTimeout(()=>{\n                GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_OPEN_ROOM, resp);\n            },1000)\n        });\n    },\n\n    onEnterRoom(resp){\n        if (resp.err > 0){\n            Toast.showText(\"加入失败，请检查房间号.\", 2);\n            return;\n        }\n        GlobalNiuNiu.loadScene(\"RoomNet\",()=>{\n            setTimeout(()=>{\n                GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_ENTER_ROOM, resp);\n            },1000)\n        });\n    }\n});\n"]}