{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\NongChang/assets\\Script\\Ui\\NongChang\\NongChang.js"],"names":["cc","Class","extends","Component","properties","NongChang","Node","TuDi","NongChangDesc","NongChangCount","onLoad","director","GlobalEvent","on","onNongChangUserData","onFriendNongChangUserData","dataFunc","loadConfigs","start","onDestroy","off","table","backPack","GameData","NongChangUserData","i","undefined","id","getComponent","Sprite","enabled","loader","loadRes","queryValue","period","err","res","console","error","spriteFrame","SpriteFrame","getChildByName","destroy","e","tip","instantiate","Global","ResourceMgr","parent","setItem","x","y","EventType","TOUCH_END","clearPage","active","Label","string","time","getMyDate","fillRange","ProtocolMgr","shouHuoNongZuoWu","data","finish","emit","shouhuoAnim","PageMgr","showTipPage","log","ZhongZhiReady","state","zhongZhi","pos","onOpenPage","length","FriendNongChangUserData","target","callback","action","sequence","moveBy","v2","callFunc","runAction","closeAllPages"],"mappings":"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","file":"NongChang.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\NongChang","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        NongChang:[cc.Node],\r\n        TuDi:[cc.Node],\r\n        NongChangDesc:cc.Node,\r\n        NongChangCount:6,\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        cc.director.GlobalEvent.on(\"NongChangUserData\",this.onNongChangUserData,this)\r\n        cc.director.GlobalEvent.on(\"FriendNongChangUserData\",this.onFriendNongChangUserData,this)\r\n        //加载数据表\r\n        dataFunc.loadConfigs(false,()=>{\r\n            // Global.ProtocolMgr.queryNongChangUserData()\r\n        });\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n    onDestroy(){\r\n        cc.director.GlobalEvent.off(\"NongChangUserData\")\r\n        cc.director.GlobalEvent.off(\"FriendNongChangUserData\")\r\n    },\r\n    //监听农场信息更新\r\n    onNongChangUserData(){\r\n        let table = 'zhongzi'\r\n        let backPack = GameData.NongChangUserData;\r\n        for(let i = 0;i< backPack.length;i++){\r\n            if(backPack[i]!=undefined&&backPack[i]!=null){\r\n                let id = backPack[i].id + ''\r\n                this.NongChang[i].getComponent(cc.Sprite).enabled = true;\r\n                cc.loader.loadRes('NongChang/'+dataFunc.queryValue(table,\"name\",id)+backPack[i].period,(err,res)=>{\r\n                    if(err){\r\n                        console.error(err);\r\n                        return;\r\n                    }\r\n                    let spriteFrame = new cc.SpriteFrame(res)\r\n                    this.NongChang[i].getComponent(cc.Sprite).spriteFrame = spriteFrame\r\n                    if(backPack[i].period==3){\r\n                        //防止重复\r\n                        try {\r\n                            this.NongChang[i].getChildByName('Tip').destroy()\r\n                        }catch (e) {\r\n                        }\r\n                        let tip = cc.instantiate(Global.ResourceMgr.tip);\r\n                        tip.parent = this.NongChang[i];\r\n                        tip.getComponent('Tip').setItem('收获')\r\n                        tip.x = 0;\r\n                        tip.y = 33;\r\n                    }\r\n                })\r\n                this.NongChang[i].off(cc.Node.EventType.TOUCH_END)\r\n                this.NongChang[i].on(cc.Node.EventType.TOUCH_END,()=>{\r\n                    if(!backPack[i]){\r\n                        return\r\n                    }\r\n                    let id = backPack[i].id + ''\r\n                    this.clearPage()\r\n                    this.NongChangDesc.active = true;\r\n                    this.NongChangDesc.x = this.NongChang[i].x;\r\n                    this.NongChangDesc.y = this.NongChang[i].y;\r\n                    this.NongChangDesc.getChildByName('name').getComponent(cc.Label).string = dataFunc.queryValue(table,\"name\",id);\r\n                    let time = backPack[i].time;\r\n                    let period = dataFunc.queryValue(table,'time',id);\r\n                    this.NongChangDesc.getChildByName('period').getComponent(cc.Label).string = dataFunc.getMyDate(time)\r\n                    this.NongChangDesc.getChildByName('process').getComponent(cc.Sprite).fillRange = (period-time)/period;\r\n                    //时期为3表示可收获\r\n                    if(backPack[i].period==3){\r\n                        Global.ProtocolMgr.shouHuoNongZuoWu(i,(data)=>{\r\n                            if(data){\r\n                                // Global.ProtocolMgr.queryNongChangUserData()\r\n                                this.NongChang[i].getChildByName('Tip').destroy()\r\n                                cc.loader.loadRes('NongChang/'+dataFunc.queryValue(table,\"name\",id)+'4',(err,res)=>{\r\n                                    if(err){\r\n                                        console.error(err);\r\n                                        return;\r\n                                    }\r\n                                    let spriteFrame = new cc.SpriteFrame(res)\r\n                                    this.NongChang[i].getComponent(cc.Sprite).spriteFrame = spriteFrame\r\n                                })\r\n                                let finish = ()=>{\r\n                                    this.NongChang[i].y-=50;\r\n                                    this.NongChang[i].getComponent(cc.Sprite).spriteFrame = null;\r\n                                    cc.director.GlobalEvent.emit(\"NongChangUserData\",{})\r\n                                }\r\n                                this.shouhuoAnim(this.NongChang[i],finish)\r\n                            }else{\r\n                                Global.PageMgr.showTipPage('收获失败')\r\n                            }\r\n                        });\r\n                        return\r\n                    }\r\n                })\r\n            }else{\r\n                try {\r\n                    this.NongChang[i].getChildByName('Tip').destroy()\r\n                }catch (e) {\r\n                    console.log('空土地')\r\n                }\r\n                this.NongChang[i].off(cc.Node.EventType.TOUCH_END)\r\n                this.NongChang[i].on(cc.Node.EventType.TOUCH_END,()=>{\r\n                    console.log(GameData.ZhongZhiReady.state)\r\n                    if(GameData.ZhongZhiReady.state){\r\n                        Global.ProtocolMgr.zhongZhi(GameData.ZhongZhiReady.id,i)\r\n                    }else{\r\n                        this.clearPage()\r\n                        GameData.ZhongZhiReady.pos = i\r\n                        Global.PageMgr.onOpenPage(2)\r\n                    }\r\n                })\r\n            }\r\n        }\r\n    },\r\n    //监听好友农场信息更新\r\n    onFriendNongChangUserData(){\r\n        let table = 'zhongzi'\r\n        let backPack = GameData.FriendNongChangUserData;\r\n        for(let i = 0;i< backPack.length;i++){\r\n            if(backPack[i]!=undefined&&backPack[i]!=null){\r\n                let id = backPack[i].id + ''\r\n                cc.loader.loadRes('NongChang/'+dataFunc.queryValue(table,\"name\",id)+backPack[i].period,(err,res)=>{\r\n                    if(err){\r\n                        console.error(err);\r\n                        return;\r\n                    }\r\n                    let spriteFrame = new cc.SpriteFrame(res)\r\n                    this.NongChang[i].getComponent(cc.Sprite).spriteFrame = spriteFrame\r\n                    if(backPack[i].period==3){\r\n                        //防止重复\r\n                        try {\r\n                            this.NongChang[i].getChildByName('Tip').destroy()\r\n                        }catch (e) {\r\n                        }\r\n                        let tip = cc.instantiate(Global.ResourceMgr.tip);\r\n                        tip.parent = this.NongChang[i];\r\n                        tip.getComponent('Tip').setItem('偷取')\r\n                        tip.x = 0;\r\n                        tip.y = 33;\r\n                    }\r\n                })\r\n                this.NongChang[i].off(cc.Node.EventType.TOUCH_END)\r\n                this.NongChang[i].on(cc.Node.EventType.TOUCH_END,()=>{\r\n                    let id = backPack[i].id + ''\r\n                    this.clearPage()\r\n                    this.NongChangDesc.active = true;\r\n                    this.NongChangDesc.x = this.NongChang[i].x;\r\n                    this.NongChangDesc.y = this.NongChang[i].y;\r\n                    this.NongChangDesc.getChildByName('name').getComponent(cc.Label).string = dataFunc.queryValue(table,\"name\",id);\r\n                    let time = backPack[i].time;\r\n                    let period = dataFunc.queryValue(table,'time',id);\r\n                    this.NongChangDesc.getChildByName('period').getComponent(cc.Label).string = dataFunc.getMyDate(time)\r\n                    this.NongChangDesc.getChildByName('process').getComponent(cc.Sprite).fillRange = (period-time)/period;\r\n                    if(backPack[i].period==3){\r\n                        Global.ProtocolMgr.shouHuoNongZuoWu(i,(data)=>{\r\n                            if(data){\r\n                                // Global.ProtocolMgr.queryNongChangUserData()\r\n                                cc.director.GlobalEvent.emit(\"FriendNongChangUserData\",{})\r\n                                Global.PageMgr.showTipPage(dataFunc.queryValue(table,\"name\",id)+'+1')\r\n                                this.NongChangDesc.active = false;\r\n                                this.NongChang[i].getChildByName('Tip').destroy()\r\n                            }else{\r\n                                Global.PageMgr.showTipPage('收获失败')\r\n                            }\r\n                        });\r\n                        return\r\n                    }\r\n                })\r\n            }else{\r\n                this.NongChang[i].getComponent(cc.Sprite).spriteFrame = null\r\n                try {\r\n                    this.NongChang[i].getChildByName('Tip').destroy()\r\n                }catch (e) {\r\n                    console.log('空土地')\r\n                }\r\n            }\r\n        }\r\n    },\r\n    //收获动画\r\n    shouhuoAnim(target,callback){\r\n        let action = cc.sequence(cc.moveBy(1,cc.v2(0,50)),cc.callFunc(callback))\r\n        target.runAction(action)\r\n        this.NongChangDesc.active = false;\r\n    },\r\n    clearPage(){\r\n        this.NongChangDesc.active = false;\r\n        Global.PageMgr.closeAllPages()\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}