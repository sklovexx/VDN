{"version":3,"sources":["..\\..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\net\\socket/assets\\NiuNiu\\script\\net\\socket\\NetProxy.js"],"names":["GameNetwork","require","GameProtocols","playerData","getInstance","playerObj","GAME_SERVER_URL","NetProxy","cc","Class","ctor","network","_cachePushCallback","init","setDelegate","initPushCallback","connect","closeConnect","isNetworkOpened","isSocketOpened","isNetworkClosed","isSocketClosed","onNetworkOpen","GlobalNiuNiu","eventMgr","emit","config","EVENT_NETWORK_OPENED","onNetworkClose","EVENT_NETWORK_CLOSED","self","pushCallback","resp","registerPushResponseCallback","registerPush","key","cb","target","bind","act","offPush","offCallback","dealCachePush","beatHeart","callback","req","HeartRequest","t","Date","now","sendRequest","chat","msg","ChatRequest","uid","createRoom","CreateRoomRequest","enterRoom","rid","EnterRoomRequest","quitRoom","QuitRoomRequest","startGame","StartGameRequest","ready","ReadyRequest","console","log","ConfigRequest","kick","KickRequest","payBet","bet","BetRequest","GetQueryVariable","variable","query","window","location","search","substring","vars","split","i","length","pair","login","origin","token","LoginRequest","os","sys","osVersion","err","EVENT_LOGIN_FAILED","EVENT_LOGIN_SUC","logout","bindFacebook","getRank","rankType","response","pushFriendSendTakeSp","pushPlayChess","pushChat","pushExitRoom","EVENT_CHAT","EVENT_EXITROOM","EVENT_PLAYCHESS","debug_addCoins","name","DebugChangeMeRequest","cmd","module","exports"],"mappings":"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","file":"NetProxy.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\net\\socket","sourcesContent":["/**\r\n * Created by skyxu on 2018/10/9.\r\n */\r\n\r\n\"use strict\";\r\n\r\nlet GameNetwork = require(\"./GameNetwork\");\r\nlet GameProtocols = require(\"./GameProtocols\");\r\nlet playerData = require(\"./../../Common/DataMgr\").getInstance().playerObj;\r\n\r\nlet GAME_SERVER_URL = 'ws://8.210.235.222:3005/ws';\r\n// GAME_SERVER_URL = 'wss://echo.websocket.org';\r\n// let GAME_SERVER_URL = \"ws://\"+Config.socketUrl+\":3005/ws\";\r\n\r\nlet NetProxy = cc.Class({\r\n    ctor: function () {\r\n        this.network = null;\r\n        this._cachePushCallback = [];\r\n    },\r\n\r\n    init: function () {\r\n        this.network = new GameNetwork();\r\n        this.network.setDelegate(this);\r\n        this.initPushCallback();\r\n    },\r\n    connect: function () {\r\n        this.network.connect(GAME_SERVER_URL);\r\n    },\r\n\r\n    closeConnect: function () {\r\n        this.network.closeConnect();\r\n    },\r\n\r\n    isNetworkOpened: function () {\r\n        return this.network.isSocketOpened();\r\n    },\r\n\r\n    isNetworkClosed: function () {\r\n        return this.network.isSocketClosed();\r\n    },\r\n\r\n    onNetworkOpen: function () {\r\n        GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_NETWORK_OPENED);\r\n    },\r\n\r\n    onNetworkClose: function () {\r\n        GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_NETWORK_CLOSED);\r\n    },\r\n\r\n    /**\r\n     * 注册push回调接口\r\n     */\r\n    initPushCallback: function () {\r\n        let self = this;\r\n        let pushCallback = function (resp) {\r\n            self.pushCallback(resp);\r\n        };\r\n\r\n        this.network.registerPushResponseCallback('chat', pushCallback);\r\n        this.network.registerPushResponseCallback('exitRoom', pushCallback);\r\n        this.network.registerPushResponseCallback('playChess', pushCallback);\r\n    },\r\n\r\n    /**\r\n     * 注册推送\r\n     * @param {String} key\r\n     * @param {function(resp)} cb\r\n     */\r\n    registerPush(key, cb, target){\r\n        let self = this;\r\n        if (cb && target){\r\n            cb = cb.bind(target);\r\n        }\r\n        let pushCallback = function (resp) {\r\n            if (cb){\r\n                cb(resp);\r\n            }\r\n            GlobalNiuNiu.eventMgr.emit(resp.act, resp);\r\n        };\r\n\r\n        this.network.registerPushResponseCallback(key, pushCallback);\r\n    },\r\n    offPush(key, cb){\r\n        this.network.offCallback(key,cb);\r\n    },\r\n    /**\r\n     * 处理缓存push\r\n     */\r\n    dealCachePush: function () {\r\n        // if(this._cachePushCallback.length > 0){\r\n        //     for(var i = 0; i < this._cachePushCallback.length; i++){\r\n        //         this.pushCallback(this._cachePushCallback[i]);\r\n        //     }\r\n        // }\r\n        // this._cachePushCallback = [];\r\n    },\r\n\r\n    beatHeart: function (callback) {\r\n        let req = new GameProtocols.HeartRequest();\r\n        req.t = Date.now();\r\n        this.network.sendRequest(req, callback);\r\n    },\r\n\r\n    chat: function (msg) {\r\n        let req = new GameProtocols.ChatRequest();\r\n        let uid = playerData.uid;\r\n        req.uid = uid;\r\n        req.msg = msg;\r\n        this.network.sendRequest(req);\r\n    },\r\n\r\n\r\n    createRoom: function (cb) {\r\n        let req = new GameProtocols.CreateRoomRequest();\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req, cb);\r\n    },\r\n\r\n    enterRoom: function (rid, cb) {\r\n        let req = new GameProtocols.EnterRoomRequest();\r\n        req.rid = rid;\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req, cb);\r\n    },\r\n    quitRoom: function (rid, cb) {\r\n        let req = new GameProtocols.QuitRoomRequest();\r\n        req.rid = rid;\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req, cb);\r\n    },\r\n    startGame: function () {\r\n        let req = new GameProtocols.StartGameRequest();\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req);\r\n    },\r\n    ready: function (callback){\r\n        let req = new GameProtocols.ReadyRequest();\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req,callback)\r\n    },\r\n    config: function (){\r\n        console.log(1)\r\n        let req = new GameProtocols.ConfigRequest();\r\n        this.network.sendRequest(req)\r\n    },\r\n    kick: function (){\r\n        let req = new GameProtocols.KickRequest();\r\n        req.uid = playerData.uid;\r\n        this.network.sendRequest(req)\r\n    },\r\n    payBet: function (bet) {\r\n        let req = new GameProtocols.BetRequest();\r\n        req.uid = playerData.uid;\r\n        req.bet = bet;\r\n        this.network.sendRequest(req);\r\n    },\r\n    GetQueryVariable:function(variable)\r\n    {\r\n        let query = window.location.search.substring(1);\r\n        let vars = query.split(\"&\");\r\n        for (let i=0;i<vars.length;i++) {\r\n            let pair = vars[i].split(\"=\");\r\n            if(pair[0] == variable){return pair[1];}\r\n        }\r\n        return(false);\r\n    },\r\n    /**\r\n     * Facebook或者游客登录接口\r\n     * @param {Object.<LoginOriginType>} origin\r\n     * @param token\r\n     */\r\n    login: function (origin, token) {\r\n        let req = new GameProtocols.LoginRequest();\r\n        if(token) req.token = token;\r\n        req.origin = origin;\r\n        req.os = cc.sys.os;\r\n        req.osVersion = cc.sys.osVersion;\r\n        playerData.uid = this.GetQueryVariable('token')\r\n        let uid = playerData.uid;\r\n        req.uid = uid;\r\n        // req.language = cc.sys.language;//farm.FarmPlatformHelper.jsToOc(farm.FarmPlatformHelper.JSB_EVENT_JTO_GetCurrentLanguage);\r\n        /*\r\n         req.deviceModel = '';\r\n         req.channelId = 0;\r\n         req.idfa = '';\r\n         req.androidId = '';\r\n         req.googleAid = '';\r\n         req.appVersion = '';\r\n         req.packName = '';\r\n         */\r\n        let callback =  function (resp) {\r\n            if(resp.err != 0){\r\n                GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_LOGIN_FAILED, resp);\r\n                return;\r\n            }\r\n            // if(resp.token && resp.token.length > 0){\r\n            //     farm.localStorage.setItem(farm.game.gmConst.GLS_KEY_GUEST_TOKEN, resp.token);\r\n            // }\r\n            // farm.localStorage.removeItem(farm.game.gmConst.GLS_KEY_IS_LOGOUT);\r\n            //\r\n            // //\r\n            // farm.game.initConfig(resp);\r\n            // farm.game.initData(resp);\r\n            // farm.game.loginSuccess = true;\r\n\r\n            // js 调取其他平台的sdk，传过去玩家id\r\n            // farm.FarmPlatformHelper.jsToOc(farm.FarmPlatformHelper.JSB_EVENT_JTO_setSessionWithUid, farm.game.player.id.toString());\r\n            //\r\n\r\n            //登录\r\n            GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_LOGIN_SUC, resp);\r\n        };\r\n        this.network.sendRequest(req, callback);\r\n    },\r\n\r\n    /**\r\n     * Facebook或者游客登出\r\n     */\r\n    logout: function () {\r\n        // let req = new GameProtocols.LogoutRequest();\r\n        // this.network.sendRequest(req, function (resp) {\r\n        //     if(resp.err != 0){\r\n        //         cc.log(\"网络请求---LogoutRequest 失败\");\r\n        //         farm.eventManager.emit(farm.game.gmConst.SP_EVENT_LOGOUT_FAILED);\r\n        //         return;\r\n        //     }\r\n        //     cc.log(\"网络请求---LogoutRequest 成功\");\r\n        //     GlobalNiuNiu.eventMgr.emit(farm.game.gmConst.SP_EVENT_LOGOUT_SUCCESS);\r\n        // });\r\n    },\r\n\r\n    /**\r\n     * 绑定fb账号\r\n     * @param {String} token\r\n     */\r\n    bindFacebook: function (token) {\r\n        // let req = new GameProtocols.BindFacebookRequest();\r\n        // req.token = token;\r\n        // let callback =  function (resp) {\r\n        //     //绑定过得逻辑\r\n        //     if(resp.err == farm.game.gmConst.ERROR_USER_HAS_REGISTERED){\r\n        //         cc.log(\"网络请求---BindFacebookRequest 已绑定\");\r\n        //         farm.eventManager.emit(farm.game.gmConst.SP_EVENT_HAS_BIND_FACEBOOK);\r\n        //         return;\r\n        //     }\r\n        //     //绑定失败\r\n        //     if(resp.err != 0){\r\n        //         cc.log(\"网络请求---BindFacebookRequest 失败\");\r\n        //         farm.eventManager.emit(farm.game.gmConst.SP_EVENT_BIND_FACEBOOK_FAILED);\r\n        //         return;\r\n        //     }\r\n        //     //绑定成功\r\n        //     cc.log(\"网络请求---BindFacebookRequest 成功\");\r\n        //     if(resp.me){\r\n        //         farm.game.player.parse(resp.me);\r\n        //     }\r\n        //     if(resp.friends){\r\n        //         farm.game.initFriends(resp.friends);\r\n        //     }\r\n        //     //绑定成功后删除本地token\r\n        //     farm.localStorage.removeItem(farm.game.gmConst.GLS_KEY_GUEST_TOKEN);\r\n        //     farm.eventManager.emit(farm.game.gmConst.SP_EVENT_BIND_FACEBOOK_SUCCESS);\r\n        // };\r\n        // this.network.sendRequest(req, callback);\r\n    },\r\n\r\n    /**\r\n     * 获取排名\r\n     * @param {Number} rankType 0全部，1本地，2好友\r\n     */\r\n    getRank: function (rankType) {\r\n        // let req = new GameProtocols.RankRequest();\r\n        // req.type = rankType;\r\n        // let callback =  function (resp) {\r\n        //     if(resp.err != 0){\r\n        //         cc.log(\"网络请求---getRank 失败\");\r\n        //         GlobalNiuNiu.eventMgr.emit(farm.game.gmConst.SP_EVENT_GET_RANK_FAILED, resp);\r\n        //         return;\r\n        //     }\r\n        //     cc.log(\"网络请求---getRank 成功\");\r\n        //     // todo 暂定排名类型\r\n        //     resp._rankType = rankType;\r\n        //     //farm.game.initLeaderBoardArray(rankType, resp.myRank, resp.men);\r\n        //     if(rankType == 2 && resp.men){\r\n        //         farm.game.updateFriends(resp.men);\r\n        //         resp.men = farm.game.sortFriendsByStar();\r\n        //     }\r\n        //     GlobalNiuNiu.eventMgr.emit(farm.game.gmConst.SP_EVENT_GET_RANK_SUCCESS, resp);\r\n        // };\r\n        // this.network.sendRequest(req, callback);\r\n    },\r\n\r\n\r\n    //push回调------------------------------------------------------------------------------\r\n\r\n    /**\r\n     * 推送回调\r\n     */\r\n    pushCallback: function (response) {\r\n        switch (response.act){\r\n            case \"friendInfoSync\":\r\n                this.pushFriendSendTakeSp(response);\r\n                break;\r\n            case \"playChess\":\r\n                this.pushPlayChess(response);\r\n                break;\r\n            case \"chat\":\r\n                this.pushChat(response);\r\n                break;\r\n            case \"exitRoom\":\r\n                this.pushExitRoom(response);\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    },\r\n    /**\r\n     * 好友间互赠体力推送\r\n     * @param {PushSendSpResponse|PushTakeSpResponse} resp\r\n     */\r\n    pushFriendSendTakeSp: function (resp) {\r\n        // cc.log(\"网络请求---push--- pushFriendSendTakeSp 成功\");\r\n        // if(resp.friend) farm.game.updateFriends(resp.friend);\r\n        // farm.eventManager.emit(farm.game.gmConst.SP_PUSH_EVENT_UPDATE_FRIEND);\r\n    },\r\n\r\n\r\n    pushChat: function (resp) {\r\n        GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_CHAT, resp);\r\n    },\r\n\r\n    pushExitRoom: function (resp) {\r\n        GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_EXITROOM, resp);\r\n    },\r\n\r\n    pushPlayChess: function(resp){\r\n        GlobalNiuNiu.eventMgr.emit(GlobalNiuNiu.config.EVENT_PLAYCHESS, resp);\r\n    },\r\n\r\n    /**\r\n     * debug调试请求\r\n     * @param {String} name\r\n     */\r\n    debug_addCoins: function (name) {\r\n        var req = new GameProtocols.DebugChangeMeRequest();\r\n        if (name === \"btnAddCoins\") {\r\n            req.cmd = \"player coins add 100000000\";\r\n        } else if (name === \"btnClearCoins\") {\r\n            req.cmd = \"player coins 0\";\r\n        } else if (name === \"btnAddEnergy\") {\r\n            req.cmd = \"player sp add 10\";\r\n        } else if (name === \"btnClearEnergy\") {\r\n            req.cmd = \"player sp 0\";\r\n        } else if (name == \"btnAddWp\") {\r\n            req.cmd = \"player wp add 10\";\r\n        } else if (name == \"btnClearWp\") {\r\n            req.cmd = \"player wp 0\";\r\n        } else if (name == \"btnUnwrap\"){\r\n            req.cmd = \"player fbuid null\";\r\n        } else if (name == \"btnWizard1\"){\r\n            req.cmd = \"player wizard1 0\";\r\n        } else if (name == \"btnWizard2\"){\r\n            req.cmd = \"player wizard2 0\";\r\n        } else if (name == \"btnClearShield\"){\r\n            req.cmd = \"player shield 0\";\r\n        } else if (name == \"btnSpEc\"){\r\n            req.cmd = \"SpEc stepInterval 60000\";\r\n        } else if (name == \"btnFarmEc\"){\r\n            req.cmd = \"FarmEc stepInterval 60000\";\r\n        } else if (name == \"btnSpEcBack\"){\r\n            req.cmd = \"SpEc stepInterval 3600000\";\r\n        } else if (name == \"btnFarmBack\"){\r\n            req.cmd = \"FarmEc stepInterval 86400000\";\r\n        } else if (name == \"btnUpdateBuild\"){\r\n            req.cmd = \"Building lv 5\";\r\n        } else {\r\n            req.cmd = name;\r\n        }\r\n        // var callback = function (resp) {\r\n        //     if (resp.err != 0) {\r\n        //         return;\r\n        //     }\r\n        //     farm.game.player.parse(resp.me);\r\n        //     farm.game.spTimer.updateSpTime(resp.spStepLeftTime, resp.spInterval);\r\n        //     farm.game.dataUpdater.updateCoin();\r\n        //     farm.game.dataUpdater.updateSp();\r\n        //     farm.game.dataUpdater.updateShield();\r\n        //     farm.game.dataUpdater.updateStar();\r\n        //     //\r\n        //     if((req.cmd == \"FarmEc stepInterval 60000\" || req.cmd == \"FarmEc stepInterval 86400000\")\r\n        //         && farm.util.isNumber(resp.farmDailyOut)\r\n        //         && farm.util.isNumber(resp.farmCoins)){\r\n        //         farm.game.piggyBankTimer.init(resp.farmDailyOut, resp.farmCoins, resp.farmInterval);\r\n        //     }\r\n        //     if(req.cmd == \"SpEc stepInterval 60000\" || req.cmd == \"SpEc stepInterval 3600000\"){\r\n        //         farm.game.spTimer.updateSpTime(resp.spStepLeftTime, resp.spInterval);\r\n        //     }\r\n        //     if(resp.buildings){\r\n        //         for(var i = 0; i < resp.buildings.length; ++i){\r\n        //             farm.game.buildings[i].parse(resp.buildings[i]);\r\n        //         }\r\n        //         farm.eventManager.emit(farm.game.gmConst.SP_EVENT_UPGRADE_BUILDING_SUCCESS, resp);\r\n        //         farm.eventManager.emit(farm.game.gmConst.SP_DEBUG_EVENT_BUILD_TO_24_SUCCESS, resp);\r\n        //     }\r\n        // };\r\n        // this.network.sendRequest(req, callback);\r\n    },\r\n});\r\n\r\nmodule.exports = NetProxy;"]}