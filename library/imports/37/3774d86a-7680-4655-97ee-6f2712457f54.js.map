{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\Manager/assets\\Script\\Manager\\SocketMgr.js"],"names":["cc","Class","extends","Component","properties","onLoad","handle","game","addPersistRootNode","node","Global","SocketMgr","getComponent","openSocket","ws","WebSocket","Config","socketUrl","onopen","onmessage","evt","onclose","console","log","closeSocket","callback","close","start","send_data","data","undefined","readyState","OPEN","send","JSON","stringify","GetQueryVariable","variable","query","window","location","search","substring","vars","split","i","length","pair"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY,EAHP;;AAML;;AAEAC,UARK,oBAQK;AACN,aAAKC,MAAL,GAAY,EAAZ;AACAN,WAAGO,IAAH,CAAQC,kBAAR,CAA2B,KAAKC,IAAhC;AACAC,eAAOC,SAAP,GAAmB,KAAKF,IAAL,CAAUG,YAAV,CAAuB,WAAvB,CAAnB;AACH,KAZI;;AAaL;AACAC,cAdK,wBAcO;AACR;AACA;AACA,aAAKC,EAAL,GAAU,IAAIC,SAAJ,CAAcC,OAAOC,SAArB,CAAV,CAHQ,CAGkC;AAC1C,aAAKH,EAAL,CAAQI,MAAR,GAAiB,YACjB;AACI;AACA;AACH,SAJD;;AAMA,aAAKJ,EAAL,CAAQK,SAAR,GAAoB,UAAUC,GAAV,EACpB;AACI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SAjDD;AAkDA,aAAKN,EAAL,CAAQO,OAAR,GAAkB,YAClB;AACI;AACAC,oBAAQC,GAAR,CAAY,UAAZ;AACH,SAJD;AAKA;AACH,KAhFI;AAiFLC,eAjFK,uBAiFOC,QAjFP,EAiFgB;AACjB,aAAKX,EAAL,CAAQY,KAAR;AACAD;AACH,KApFI;AAqFLE,SArFK,mBAqFI,CAER,CAvFI;;;AAyFL;AACAC,aA1FK,qBA0FKC,IA1FL,EA0FW;AACZ,YAAI,KAAKf,EAAL,IAAWgB,SAAX,IAAwB,KAAKhB,EAAL,CAAQiB,UAAR,IAAsBhB,UAAUiB,IAA5D,EAAkE;AAC9D,iBAAKlB,EAAL,CAAQmB,IAAR,CAAaC,KAAKC,SAAL,CAAeN,IAAf,CAAb;AACH;AACJ,KA9FI;;;AAgGLO,sBAAiB,0BAASC,QAAT,EACjB;AACI,YAAIC,QAAQC,OAAOC,QAAP,CAAgBC,MAAhB,CAAuBC,SAAvB,CAAiC,CAAjC,CAAZ;AACA,YAAIC,OAAOL,MAAMM,KAAN,CAAY,GAAZ,CAAX;AACA,aAAK,IAAIC,IAAE,CAAX,EAAaA,IAAEF,KAAKG,MAApB,EAA2BD,GAA3B,EAAgC;AAC5B,gBAAIE,OAAOJ,KAAKE,CAAL,EAAQD,KAAR,CAAc,GAAd,CAAX;AACA,gBAAGG,KAAK,CAAL,KAAWV,QAAd,EAAuB;AAAC,uBAAOU,KAAK,CAAL,CAAP;AAAgB;AAC3C;AACD,eAAO,KAAP;AACH;AACD;AA1GK,CAAT","file":"SocketMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Manager","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.handle=[]\n        cc.game.addPersistRootNode(this.node);\n        Global.SocketMgr = this.node.getComponent(\"SocketMgr\");\n    },\n    //打开socket\n    openSocket(){\n        // this.ws = new WebSocket('ws://192.168.199.221:8321/websocket/Bearer '+this.GetQueryVariable('token'));//测试地址\n        // this.ws = new WebSocket(Config.socketUrl+'/websocket/Bearer '+this.GetQueryVariable('token'));//正式环境\n        this.ws = new WebSocket(Config.socketUrl);//正式环境\n        this.ws.onopen = function()\n        {\n            // Web Socket 已连接上，使用 send() 方法发送数据\n            // this.ws.send(data);\n        };\n        \n        this.ws.onmessage = function (evt)\n        {\n            // let data = JSON.parse(evt.data);\n            // // console.log(\"数据已接收\");\n            // console.log(data)\n            // switch (data.event) {\n            //     //用戶數據刷新\n            //     case 'USER_REFRESH':\n            //         GameData.HongBaoUserData = data.data;\n            //         cc.director.GlobalEvent.emit(\"HongBaoUserData\",{})\n            //         break;\n            //     //新一輪紅包\n            //     case 'START':\n            //         GameData.CurHongBao = data.data;\n            //         cc.director.GlobalEvent.emit(\"CurHongBaoData\",{})\n            //         break;\n            //     //新一輪紅包倒計時\n            //     case 'TIME_REFRESH':\n            //         GameData.CountDown = data.data.time;\n            //         cc.director.GlobalEvent.emit(\"CountDown\",{})\n            //         GameData.KaiJiangList = data.data.data;\n            //         cc.director.GlobalEvent.emit(\"KaiJiangList\",{})\n            //         break;\n            //     //結算開始\n            //     case 'SETTLEMENT_START':\n            //         GameData.ReadParkSinl = 0;\n            //         // Global.PageMgr.showLoadingPage('正在结算，请稍后')\n            //         break;\n            //     //結算結束\n            //     case 'SETTLEMENT_END':\n            //         GameData.KaiJiangList = data.data.members;\n            //         GameData.HongBaoJieGuo = data.data.bankerProFit;\n            //         cc.director.GlobalEvent.emit(\"KaiJiangList\",{})\n            //         cc.director.GlobalEvent.emit(\"KaiJiang\",{})\n            //         // Global.PageMgr.closeLoadingPage()\n            //         break;\n            //     //玩家列表刷新\n            //     case 'RED_REFRESH':\n            //         GameData.HongBaoList = data.data;\n            //         cc.director.GlobalEvent.emit(\"HongBaoListData\",{})\n            //         break;\n            //     //服務器即將開始維護事件\n            //     case 'ABOUT_TO_BEGIN_MAINTENANCE':\n            //         console.log(data);\n            //         Global.PageMgr.showTipPage('服务器即将开始维护')\n            //         break;\n            //     default:\n            //         return;\n            // }\n        };\n        this.ws.onclose = function()\n        {\n            // 关闭 websocket\n            console.log(\"连接已关闭...\");\n        };\n        // 打开一个 web socket\n    },\n    closeSocket(callback){\n        this.ws.close()\n        callback()\n    },\n    start () {\n\n    },\n    \n    // 发送数据, sock.send;\n    send_data(data) {\n        if (this.ws != undefined && this.ws.readyState == WebSocket.OPEN) {\n            this.ws.send(JSON.stringify(data));\n        } \n    },\n\n    GetQueryVariable:function(variable)\n    {\n        let query = window.location.search.substring(1);\n        let vars = query.split(\"&\");\n        for (let i=0;i<vars.length;i++) {\n            let pair = vars[i].split(\"=\");\n            if(pair[0] == variable){return pair[1];}\n        }\n        return(false);\n    },\n    // update (dt) {},\n});\n"]}