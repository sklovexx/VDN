{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\Racing/assets\\Script\\Ui\\Racing\\Racing.js"],"names":["cc","Class","extends","Component","properties","carCount","linesCount","lineArr","type","Node","default","line","Prefab","Content","car","SubPanel","Ranking","onLoad","director","GlobalEvent","on","onUpdateRanking","onUpdateNextTurn","onUpdateNextTurnTimer","onRacingStart","Global","ProtocolMgr","Racing","rank","timerSpeedUp","forEach","i","node","instantiate","parent","e","start","x","currentIndex","currentMoney","getChildByName","children","getComponent","Toggle","isChecked","Label","string","racing","Sprite","spriteFrame","SpriteFrame","ResourceMgr","CarTexture","EventType","TOUCH_END","SpeedUpById","push","GameData","RacingGameState","active","RacingTimer","ani","Animation","aniState","getAnimationState","speed","Math","random","timer","setInterval","RacingSpeedUp","finish","clearInterval","length","emit","setTimeout","clear","PageMgr","showTipPage","playAdditive","ClosePage","onClosePage","onEnable","destroy","OpenSubPanel","event","customEventData","CloseSubPanel","TouZhu","parseInt","name","money","num","id","clearTimeout","console","error","SpeedUp","update","dt","ScrollView","horizontal"],"mappings":"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","file":"Racing.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\Racing","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        carCount:8,\r\n        linesCount:47,\r\n        lineArr:{\r\n            type:cc.Node,\r\n            default:[],\r\n        },\r\n        line:{\r\n            type:cc.Prefab,\r\n            default:null,\r\n        },\r\n        Content:cc.Node,\r\n        car:{\r\n            type:cc.Prefab,\r\n            default:null,\r\n        },\r\n        SubPanel:{\r\n            type:cc.Node,\r\n            default:[],\r\n        },\r\n        Ranking:{\r\n            type:cc.Node,\r\n            default:[],\r\n        }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        cc.director.GlobalEvent.on(\"UpdateRanking\", this.onUpdateRanking, this)\r\n        cc.director.GlobalEvent.on(\"NextTurn\", this.onUpdateNextTurn, this)\r\n        cc.director.GlobalEvent.on(\"NextTurnTimer\", this.onUpdateNextTurnTimer, this)\r\n        cc.director.GlobalEvent.on(\"RacingStart\", this.onRacingStart, this)\r\n        Global.ProtocolMgr.Racing();\r\n        this.rank = [];\r\n        this.timerSpeedUp = [];\r\n        this.lineArr.forEach(e=>{\r\n            for(let i = 0;i<this.linesCount;i++){\r\n                let node = cc.instantiate(this.line);\r\n                node.parent = e;\r\n            }\r\n        })\r\n    },\r\n\r\n    start () {\r\n    },\r\n    //開始新一輪比賽\r\n    onUpdateNextTurn(){\r\n        this.Content.parent.x = 0;\r\n        this.currentIndex = 0;\r\n        this.currentMoney = 0;\r\n        this.SubPanel[0].getChildByName('Num').children.forEach(e=>{\r\n            e.getComponent(cc.Toggle).isChecked = false;\r\n        })\r\n        this.SubPanel[0].getChildByName('Money').children.forEach(e=>{\r\n            e.getComponent(cc.Toggle).isChecked = false;\r\n        })\r\n        this.node.getChildByName('Tip').getComponent(cc.Label).string = '请选择要投注的车号'\r\n        this.racing = [];\r\n        for(let i = 0;i<this.carCount;i++){\r\n            let node = cc.instantiate(this.car);\r\n            node.parent = this.Content;\r\n            node.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.CarTexture[i])\r\n            node.on(cc.Node.EventType.TOUCH_END,()=>{\r\n                this.SpeedUpById(i)\r\n            },this)\r\n            this.racing.push(node)\r\n        }\r\n    },\r\n    //下一輪倒計時更新\r\n    onUpdateNextTurnTimer(){\r\n        GameData.RacingGameState = 0;\r\n        this.node.getChildByName('Timer').active = true;\r\n        this.node.getChildByName('Timer').getChildByName('Text').getComponent(cc.Label).string = GameData.RacingTimer\r\n    },\r\n    //比賽開始\r\n    onRacingStart(){\r\n        GameData.RacingGameState = 1;\r\n        this.node.getChildByName('Timer').active = false;\r\n        this.racing.forEach((e,i)=>{\r\n            let ani = e.getComponent(cc.Animation);\r\n            let aniState = ani.getAnimationState('racing');\r\n            aniState.speed = Math.random()*1+1;\r\n            let timer = setInterval(()=>{\r\n                aniState.speed = e.RacingSpeedUp? 2:Math.random()*0.8+1;\r\n            },1000)\r\n            let finish = ()=>{\r\n                clearInterval(timer)\r\n                this.rank.push(i)\r\n                if(this.rank.length>=this.carCount){\r\n                    GameData.RacingGameState = 2;\r\n                    cc.director.GlobalEvent.emit(\"UpdateRanking\",{})\r\n                    setTimeout(()=>{\r\n                        this.clear()\r\n                        Global.ProtocolMgr.Racing();\r\n                    },2000)\r\n                    this.rank.forEach((e,i)=>{\r\n                        if(e+1==this.currentIndex){\r\n                            Global.PageMgr.showTipPage('您投注的车获得了第'+(i+1)+'名')\r\n                        }\r\n                    })\r\n                }\r\n            }\r\n            ani.on('finished',finish,this);\r\n            ani.playAdditive();\r\n        })\r\n    },\r\n    ClosePage(){\r\n        Global.PageMgr.onClosePage(4)\r\n    },\r\n    onEnable(){\r\n\r\n    },\r\n    clear(){\r\n        this.rank = []\r\n        let children = this.Content.children;\r\n        children.forEach(e =>{\r\n            e.destroy();\r\n        })\r\n    },\r\n    OpenSubPanel(event, customEventData){\r\n        if(GameData.RacingGameState==1){\r\n            Global.PageMgr.showTipPage('游戏已开始')\r\n            return;\r\n        }\r\n        this.SubPanel[customEventData].active = true;\r\n    },\r\n    CloseSubPanel(event, customEventData){\r\n        this.SubPanel[customEventData].active = false;\r\n    },\r\n    //投注\r\n    TouZhu(){\r\n        this.SubPanel[0].getChildByName('Num').children.forEach(e=>{\r\n            if(e.getComponent(cc.Toggle).isChecked){\r\n                this.currentIndex = parseInt(e.name)\r\n            }\r\n        })\r\n        this.SubPanel[0].getChildByName('Money').children.forEach(e=>{\r\n            if(e.getComponent(cc.Toggle).isChecked){\r\n                this.currentMoney = parseInt(e.name)\r\n            }\r\n        })\r\n        let money = this.currentMoney;\r\n        let num = this.currentIndex;\r\n        if(!num||num==0){\r\n            Global.PageMgr.showTipPage('请选择投注车号')\r\n            return;\r\n        }\r\n        if(!money||money==0){\r\n            Global.PageMgr.showTipPage('请选择投注金额')\r\n            return;\r\n        }\r\n        this.node.getChildByName('Tip').getComponent(cc.Label).string = '即将开始'\r\n        Global.PageMgr.showTipPage('成功投注'+num+'号车'+money+'ECC')\r\n        this.SubPanel[0].active = false;\r\n    },\r\n    //排行榜更新\r\n    onUpdateRanking(){\r\n        this.SubPanel[1].active = true;\r\n        this.Ranking.forEach((e,i)=>{\r\n            e.getChildByName('Item').getChildByName('Icon').getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.CarTexture[this.rank[i]])\r\n        })\r\n    },\r\n    //加速點擊車輛\r\n    SpeedUpById(id){\r\n        if(GameData.RacingGameState!=1){\r\n            Global.PageMgr.showTipPage('游戏未开始')\r\n            return;\r\n        }\r\n        let ani = this.racing[id].getComponent(cc.Animation);\r\n        this.racing[id].getChildByName('fire1').active = false;\r\n        this.racing[id].getChildByName('fire2').active = true;\r\n        this.racing[id].getChildByName('speedUp1').active = false;\r\n        this.racing[id].getChildByName('speedUp2').active = true;\r\n        let aniState = ani.getAnimationState('racing');\r\n        aniState.speed = 2;\r\n        this.racing[id].RacingSpeedUp = true;\r\n        try{\r\n            clearTimeout(this.timerSpeedUp[id])\r\n        }catch (e) {\r\n            console.error(e)\r\n        }\r\n        this.timerSpeedUp[id] = setTimeout(()=>{\r\n            aniState.speed = Math.random()*0.8+1;\r\n            this.racing[id].getChildByName('fire1').active = true;\r\n            this.racing[id].getChildByName('fire2').active = false;\r\n            this.racing[id].getChildByName('speedUp1').active = true;\r\n            this.racing[id].getChildByName('speedUp2').active = false;\r\n            this.racing[id].RacingSpeedUp = false;\r\n        },2000)\r\n    },\r\n    //加速投注車輛\r\n    SpeedUp(){\r\n        if(GameData.RacingGameState!=1){\r\n            Global.PageMgr.showTipPage('游戏未开始')\r\n            return;\r\n        }\r\n        if(this.currentIndex==0){\r\n            Global.PageMgr.showTipPage('您没有投注车号')\r\n            return;\r\n        }\r\n        let ani = this.racing[this.currentIndex-1].getComponent(cc.Animation);\r\n        this.racing[this.currentIndex-1].getChildByName('fire1').active = false;\r\n        this.racing[this.currentIndex-1].getChildByName('fire2').active = true;\r\n        this.racing[this.currentIndex-1].getChildByName('speedUp1').active = false;\r\n        this.racing[this.currentIndex-1].getChildByName('speedUp2').active = true;\r\n        let aniState = ani.getAnimationState('racing');\r\n        aniState.speed = 2;\r\n        this.racing[this.currentIndex-1].RacingSpeedUp = true;\r\n        setTimeout(()=>{\r\n            aniState.speed = Math.random()*0.8+1;\r\n            this.racing[this.currentIndex-1].getChildByName('fire1').active = true;\r\n            this.racing[this.currentIndex-1].getChildByName('fire2').active = false;\r\n            this.racing[this.currentIndex-1].getChildByName('speedUp1').active = true;\r\n            this.racing[this.currentIndex-1].getChildByName('speedUp2').active = false;\r\n            this.racing[this.currentIndex-1].RacingSpeedUp = false;\r\n        },2000)\r\n    },\r\n    update (dt) {\r\n        //有投注車輛時視角自動跟隨\r\n        if(this.currentIndex!=0&&GameData.RacingGameState==1){\r\n            this.Content.parent.x = -(this.racing[this.currentIndex-1].x-400)\r\n            this.node.getChildByName('ScrollView').getComponent(cc.ScrollView).horizontal=false\r\n        }else{\r\n            this.node.getChildByName('ScrollView').getComponent(cc.ScrollView).horizontal=true\r\n        }\r\n    },\r\n});\r\n"]}