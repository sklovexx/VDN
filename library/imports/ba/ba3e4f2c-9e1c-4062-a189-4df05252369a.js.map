{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common/assets\\NiuNiu\\script\\common\\IAPMgr.js"],"names":["IAP","require","Utils","IAPMgr","cc","Class","ctor","iap","_initSuccess","statics","instance","getInstance","initIAP","isDebug","log","init","pay","name","restore","savePurchaseSuccessProductInfo","id","receipt","onInitialized","res","onSuccess","product","JSON","stringify","obj","productId","vender","receiptCipheredPayload","IapTools","onBuySuc","onFailure","msg","onBuyFailed","onCanceled","onRestored","onRestoreComplete","ok","onRestoreFinished","onProductRequestSuccess","products","onProductRequestFailure","module","exports"],"mappings":"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","file":"IAPMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\n * Created by skyxu on 2018/3/13.\n */\n\n\"use strict\";\n\nlet IAP = require('./IAP');\nlet Utils = require('./UtilsOther');\n\nlet IAPMgr = cc.Class({\n\n    ctor: function () {\n\n        /**\n         * @type {IAP}\n         */\n        this.iap = new IAP();\n\n        /**\n         * @type {boolean}\n         */\n        this._initSuccess = false;\n    },\n\n    statics: {\n        instance: null,\n        getInstance: function () {\n            if (IAPMgr.instance == null){\n                IAPMgr.instance = new IAPMgr();\n            }\n            return IAPMgr.instance;\n        }\n    },\n\n    /**\n     *\n     * @param isDebug{Boolean} 是否调试模式\n     */\n    initIAP: function (isDebug) {\n        cc.log(\"init iap\");\n        this._initSuccess = this.iap.init(this, isDebug);\n    },\n\n    /**\n     * @param {string} name sdkbox_config.json对应的key\n     */\n    pay: function (name) {\n        if(this._initSuccess){\n            cc.log(' 购买的商品id：' + name);\n            this.iap.pay(name);\n        }\n    },\n\n    /**\n     * 恢复购买\n     */\n    restore: function () {\n        if (this._initSuccess){\n            cc.log(\"IAPMgr restore\");\n            this.iap.restore();\n        }\n    },\n\n    /**\n     * 购买保护\n     */\n    savePurchaseSuccessProductInfo: function (id, receipt) {\n\n        // farm.localStorage.setItem()\n    },\n\n    /*********************\n     * IAP callbacks\n     *********************/\n    onInitialized: function (res) {\n        cc.log(\"sdkbox iap init: \" + res);\n    },\n\n    onSuccess : function (product) {\n        // cc.log(\"FarmIAPMgr: onSuccess \" + product);\n        cc.log(\"IAPMgr store onSuccess = \" + JSON.stringify(product));\n\n        //\n        // farm.viewManager.popLoading();\n\n        let obj = {};\n        obj.productId = product.name;\n        obj.vender = \"APPLE\";\n        obj.receipt = product.receiptCipheredPayload;\n        // farm.game.serverproxy.getPurchaseSucessfullyInfo(obj);\n        cc.log(\"buy success------------1\");\n        cc.log(\"product.name:\" + product.name);\n        IapTools.onBuySuc(product.name);\n        cc.log(\"buy success------------2\");\n\n    },\n    onFailure : function (product, msg) {\n        // cc.log(\"FarmIAPMgr: onFailure \" + product + \"  msg: \" + msg);\n        cc.log(\"IAPMgr store onFailure = \" + JSON.stringify(product) + \" ===   msg: \" + msg);\n\n        // farm.viewManager.popLoading();\n\n        cc.log(\"buy failed------------1\");\n        cc.log(\"product.name:\" + product.name);\n        IapTools.onBuyFailed(msg);\n        cc.log(\"buy failed------------2\");\n    },\n    onCanceled : function (product) {\n        // cc.log(\"FarmIAPMgr: onCanceled \" + product);\n        // farm.viewManager.popLoading();\n    },\n    onRestored : function (product) {\n        cc.log(\"IAPMgr: onRestored \" + JSON.stringify(product));\n        // farm.viewManager.popLoading();\n    },\n\n    onRestoreComplete(ok, msg){\n        cc.log(\"IAPMgr: onRestored Complete \" + ok + \", \" + msg);\n\n        IapTools.onRestoreFinished(ok, msg);\n    },\n\n    onProductRequestSuccess : function (products) {\n        //Returns you the data for all the iap products\n        //You can get each item using following method\n        //products\n\n        cc.log(\"IAPMgr store onProductRequestSuccess = \" + JSON.stringify(products));\n        // let obj = {\n        //     \"name\":\"coin_package\",\n        //     \"id\":\"com.cocos2dx.plugintest2\",\n        //     \"title\":\"\",\n        //     \"description\":\"\",\n        //     \"price\":\"\",\"currencyCode\":\"\",\n        //     \"receipt\":\"\",\n        //     \"receiptCipheredPayload\":\"\"\n        // }\n\n        // let obj = {};\n        // obj.productId = product.name;\n        // obj.vender = \"APPLE\";\n        // obj.receipt = product.receiptCipheredPayload;\n        // farm.game.serverproxy.getPurchaseSucessfullyInfo(obj);\n\n        // for (let i = 0; i < products.length; i++) {\n        //     // loop\n        //     cc.log(\"FarmIAPMgr: onProductRequestSuccess \" + i + \": \" + JSON.stringify(products[i]));\n        // }\n    },\n    onProductRequestFailure : function (msg) {\n        cc.log(\"IAPMgr: onProductRequestFailure \" + msg);\n    }\n});\n\n\nmodule.exports = IAPMgr;"]}