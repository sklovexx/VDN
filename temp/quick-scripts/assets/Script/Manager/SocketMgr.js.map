{"version":3,"sources":["SocketMgr.js"],"names":["cc","Class","extends","Component","properties","onLoad","handle","game","addPersistRootNode","node","Global","SocketMgr","getComponent","openSocket","ws","WebSocket","Config","socketUrl","GetQueryVariable","onopen","console","log","onmessage","evt","data","JSON","parse","event","GameData","HongBaoUserData","director","GlobalEvent","emit","CurHongBao","CountDown","time","KaiJiangList","ReadParkSinl","members","HongBaoJieGuo","bankerProFit","HongBaoList","PageMgr","showTipPage","onclose","closeSocket","callback","close","start","variable","query","window","location","search","substring","vars","split","i","length","pair"],"mappings":"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","file":"SocketMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\Manager","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        this.handle=[]\n        cc.game.addPersistRootNode(this.node);\n        Global.SocketMgr = this.node.getComponent(\"SocketMgr\")\n    },\n    //打开socket\n    openSocket(){\n        // this.ws = new WebSocket('ws://192.168.199.221:8321/websocket/Bearer '+this.GetQueryVariable('token'));//测试地址\n        this.ws = new WebSocket(Config.socketUrl+'/websocket/Bearer '+this.GetQueryVariable('token'));//正式环境\n        this.ws.onopen = function()\n        {\n            // Web Socket 已连接上，使用 send() 方法发送数据\n            console.log('已连接')\n        };\n\n        this.ws.onmessage = function (evt)\n        {\n            let data = JSON.parse(evt.data);\n            // console.log(\"数据已接收\");\n            console.log(data)\n            switch (data.event) {\n                //用戶數據刷新\n                case 'USER_REFRESH':\n                    GameData.HongBaoUserData = data.data;\n                    cc.director.GlobalEvent.emit(\"HongBaoUserData\",{})\n                    break;\n                //新一輪紅包\n                case 'START':\n                    GameData.CurHongBao = data.data;\n                    cc.director.GlobalEvent.emit(\"CurHongBaoData\",{})\n                    break;\n                //新一輪紅包倒計時\n                case 'TIME_REFRESH':\n                    GameData.CountDown = data.data.time;\n                    cc.director.GlobalEvent.emit(\"CountDown\",{})\n                    GameData.KaiJiangList = data.data.data;\n                    cc.director.GlobalEvent.emit(\"KaiJiangList\",{})\n                    break;\n                //結算開始\n                case 'SETTLEMENT_START':\n                    GameData.ReadParkSinl = 0;\n                    // Global.PageMgr.showLoadingPage('正在结算，请稍后')\n                    break;\n                //結算結束\n                case 'SETTLEMENT_END':\n                    GameData.KaiJiangList = data.data.members;\n                    GameData.HongBaoJieGuo = data.data.bankerProFit;\n                    cc.director.GlobalEvent.emit(\"KaiJiangList\",{})\n                    cc.director.GlobalEvent.emit(\"KaiJiang\",{})\n                    // Global.PageMgr.closeLoadingPage()\n                    break;\n                //玩家列表刷新\n                case 'RED_REFRESH':\n                    GameData.HongBaoList = data.data;\n                    cc.director.GlobalEvent.emit(\"HongBaoListData\",{})\n                    break;\n                //服務器即將開始維護事件\n                case 'ABOUT_TO_BEGIN_MAINTENANCE':\n                    console.log(data);\n                    Global.PageMgr.showTipPage('服务器即将开始维护')\n                    break;\n                default:\n                    return;\n            }\n        };\n        this.ws.onclose = function()\n        {\n            // 关闭 websocket\n            console.log(\"连接已关闭...\");\n        };\n        // 打开一个 web socket\n    },\n    closeSocket(callback){\n        this.ws.close()\n        callback()\n    },\n    start () {\n\n    },\n    GetQueryVariable:function(variable)\n    {\n        let query = window.location.search.substring(1);\n        let vars = query.split(\"&\");\n        for (let i=0;i<vars.length;i++) {\n            let pair = vars[i].split(\"=\");\n            if(pair[0] == variable){return pair[1];}\n        }\n        return(false);\n    },\n    // update (dt) {},\n});\n"]}