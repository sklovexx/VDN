{"version":3,"sources":["Email.js"],"names":["cc","Class","extends","Component","properties","EmailItem","Prefab","Content","Node","EmailContent","load","onLoad","director","GlobalEvent","on","onEmailUpdate","start","onEnable","Global","ProtocolMgr","queryEmail","active","children","forEach","node","destroy","i","instantiate","parent","getChildByName","getComponent","Label","string","GameData","EmailData","title","getMyDate","createTime","eval","isRead","EventType","TOUCH_END","showEmailContent","readEmail","id","length","onScrolling","event","tag","content","y","ClickState","closeEmailContent","str","oDate","Date","oYear","getFullYear","oMonth","getMonth","oDay","getDate","oHour","getHours","oMin","getMinutes","oSen","getSeconds","oTime","addZero","num","parseInt","onDestroy","off"],"mappings":"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","file":"Email.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\Kuangchi","sourcesContent":["\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        EmailItem:cc.Prefab,\r\n        Content:cc.Node,\r\n        EmailContent:cc.Node,\r\n        load:cc.Node\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        cc.director.GlobalEvent.on(\"EmailData\",this.onEmailUpdate,this)\r\n\r\n    },\r\n\r\n    start () {\r\n\r\n    },\r\n    onEnable(){\r\n        Global.ProtocolMgr.queryEmail(1)\r\n    },\r\n    onEmailUpdate(){\r\n        this.load.active = false;\r\n        let children = this.Content.children;\r\n        children.forEach(node=>{\r\n            node.destroy()\r\n        })\r\n        for(let i = 0;i<GameData.EmailData.length;i++){\r\n            let node = cc.instantiate(this.EmailItem);\r\n            node.parent = this.Content;\r\n            node.getChildByName('Title').getComponent(cc.Label).string = GameData.EmailData[i].title;\r\n            node.getChildByName('Time').getComponent(cc.Label).string = this.getMyDate(GameData.EmailData[i].createTime);\r\n            node.getChildByName('Tag').getComponent(cc.Label).string = eval(GameData.EmailData[i].isRead) == false ? '未读' : '已读';\r\n            node.on(cc.Node.EventType.TOUCH_END,()=>{\r\n                this.showEmailContent(i)\r\n                Global.ProtocolMgr.readEmail(GameData.EmailData[i].id)\r\n            },this)\r\n        }\r\n    },\r\n    onScrolling(event){\r\n        let tag = event.content.y%1260\r\n        //GameData.ClickState用于阻止事件多次调用\r\n        if(tag==0&&(event.content.y/1260)!=0&&GameData.ClickState){\r\n            this.load.active = true;\r\n            GameData.ClickState = 0\r\n            Global.ProtocolMgr.queryEmail(event.content.y/1260+1)\r\n        }\r\n    },\r\n    showEmailContent(i){\r\n        this.EmailContent.active = true;\r\n        this.EmailContent.getChildByName('Title').getComponent(cc.Label).string = GameData.EmailData[i].title;\r\n        this.EmailContent.getChildByName('Time').getComponent(cc.Label).string = this.getMyDate(GameData.EmailData[i].createTime);\r\n        this.EmailContent.getChildByName('New ScrollView').getChildByName('view').getChildByName('Content').getComponent(cc.Label).string = GameData.EmailData[i].content;\r\n    },\r\n    closeEmailContent(){\r\n        this.EmailContent.active = false;\r\n        this.EmailContent.getChildByName('Title').getComponent(cc.Label).string = '';\r\n        this.EmailContent.getChildByName('Time').getComponent(cc.Label).string = '';\r\n        this.EmailContent.getChildByName('New ScrollView').getChildByName('view').getChildByName('Content').getComponent(cc.Label).string = '';\r\n    },\r\n    getMyDate(str) {\r\n        let oDate = new Date(str),\r\n            oYear = oDate.getFullYear(),\r\n            oMonth = oDate.getMonth()+1,\r\n            oDay = oDate.getDate(),\r\n            oHour = oDate.getHours(),\r\n            oMin = oDate.getMinutes(),\r\n            oSen = oDate.getSeconds(),\r\n            oTime = oYear +'-'+ this.addZero(oMonth) +'-'+ this.addZero(oDay) +' '+ this.addZero(oHour) +':'+\r\n                this.addZero(oMin) +':'+this.addZero(oSen);\r\n        return oTime;\r\n    },\r\n\r\n//补零操作\r\n    addZero(num){\r\n    if(parseInt(num) < 10){\r\n        num = '0'+num;\r\n    }\r\n    return num;\r\n    },\r\n    onDestroy(){\r\n        cc.director.GlobalEvent.off(\"EmailData\")\r\n    },\r\n    // update (dt) {},\r\n});\r\n"]}