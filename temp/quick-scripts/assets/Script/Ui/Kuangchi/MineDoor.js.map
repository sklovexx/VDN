{"version":3,"sources":["MineDoor.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","duration","mineDoor","Node","treasureBox","Prefab","gold","tip","onLoad","sys","localStorage","clear","setTimeout","Global","ProtocolMgr","queryMillOutput","data","res","eval","canAccept","getItem","instantiate","parent","node","getComponent","setItem","x","y","isOpen","on","EventType","TOUCH_START","t","jumpDown","moveBy","v2","easing","easeCubicActionOut","runAction","addEgold","jump","repeat","sequence","count","timer","setInterval","clearInterval","dir","dataFunc","randomNum","launch","console","log","fadeOut","callFunc","closeTreasureBox","easeCubicActionIn","closeFinish","destroy","start"],"mappings":"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","file":"MineDoor.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\Kuangchi","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        jumpHeight:0,\n        duration:0,\n        mineDoor:cc.Node,\n        treasureBox:cc.Prefab,\n        gold:cc.Prefab,\n        tip:cc.Prefab\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        cc.sys.localStorage.clear('getEGold')\n        setTimeout(()=>{\n            Global.ProtocolMgr.queryMillOutput((data)=>{\n                let res = eval(data.data.canAccept)\n                if(cc.sys.localStorage.getItem('getEGold')==null&&res){\n                    let tip = cc.instantiate(this.tip);\n                    tip.parent = this.node.parent;\n                    tip.getComponent('Tip').setItem('获得E金币')\n                    tip.x = this.node.x;\n                    tip.y = this.node.y;\n                }\n            })\n        },400)\n\n        this.isOpen = false;\n        this.node.on(cc.Node.EventType.TOUCH_START,function (t) {\n            Global.ProtocolMgr.queryMillOutput((data)=>{\n                let res = eval(data.data.canAccept)\n                if(res&&!this.isOpen){\n                    if(cc.sys.localStorage.getItem('getEGold')==null){\n                        cc.sys.localStorage.setItem('getEGold',1)\n                    }\n                    //打开宝箱\n                    this.isOpen = true;\n                    let jumpDown = cc.moveBy(this.duration, cc.v2(0, this.jumpHeight)).easing(cc.easeCubicActionOut());\n                    this.mineDoor.runAction(jumpDown);\n                    let treasureBox = cc.instantiate(this.treasureBox);\n                    treasureBox.parent = this.node.parent;\n                    treasureBox.x = 187;\n                    treasureBox.y = -220;\n                    setTimeout(()=>{\n                        Global.ProtocolMgr.addEgold()\n                        let jump = cc.repeat(cc.sequence(cc.moveBy(1,cc.v2(0,20)),cc.moveBy(1,cc.v2(0,-20))),10)\n                        treasureBox.runAction(jump)\n                        let count = 0\n                        let timer = setInterval(()=>{\n                            if(count>=20){\n                                clearInterval(timer)\n                            }\n                            let node = cc.instantiate(this.gold)\n                            node.x = treasureBox.x;\n                            node.y = treasureBox.y;\n                            node.parent = this.node.parent;\n                            let dir = dataFunc.randomNum(0,1)==0 ? 1 : -1;\n                            node.getComponent('Gold').launch(dir)\n                            count++;\n                        },20)\n                    },500)\n                    setTimeout(()=>{\n                        console.log('获得金币');\n                        let fadeOut = cc.sequence(cc.fadeOut(1),cc.callFunc(this.closeTreasureBox,this,treasureBox));\n                        treasureBox.runAction(fadeOut);\n                        //关闭宝箱\n                        let jumpDown = cc.sequence(cc.moveBy(this.duration, cc.v2(0, -this.jumpHeight)).easing(cc.easeCubicActionIn()),cc.callFunc(this.closeFinish,this));\n                        this.mineDoor.runAction(jumpDown);\n                    },4000)\n                }\n            })\n        },this);\n    },\n    closeTreasureBox(treasureBox){\n        treasureBox.destroy()\n    },\n    closeFinish(){\n        this.isOpen = false;\n    },\n    start () {\n\n    },\n\n    // update (dt) {},\n});\n"]}