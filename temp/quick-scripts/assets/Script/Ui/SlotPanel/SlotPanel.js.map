{"version":3,"sources":["SlotPanel.js"],"names":["cc","Class","extends","Component","properties","list","type","Node","default","Content","item","Prefab","slot","onLoad","Global","ResourceMgr","undefined","find","getComponent","ProtocolMgr","PageMgr","forEach","i","node","instantiate","parent","e","num","dataFunc","randomNum","spriteFrame","SpriteFrame","SlotTexture","getChildByName","Sprite","winners","clickState","currentWager","director","GlobalEvent","on","updateWager","updateUserData","slotUserData","height","timer","Label","string","addWager","emit","minusWager","GameData","SlotUserData","dssc","startSlot","data","slotResult","code","rewardLevel","amount","message","result","result2","numList","length","indexOf","push","startAnim","audioEngine","play","slotClip","setTimeout","showTipPage","start","audio","tag","y","children","console","log","name","finish","pauseAll","action","sequence","moveBy","v2","easing","easeQuadraticActionInOut","callFunc","runAction","closeGames","destroy","onDestroy","off","loadScene","playBgAudio","update","dt","slotRecord","time","substring","reward","nickname"],"mappings":"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","file":"SlotPanel.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\Script\\Ui\\SlotPanel","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        list:{\n            type:cc.Node,\n            default:[]\n        },\n        Content:{\n            type:cc.Node,\n            default:null,\n        },\n        item:{\n            type:cc.Prefab,\n            default:null\n        },\n        slot:{\n            type:cc.Prefab,\n            default:null\n        },\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        if(Global.ResourceMgr==undefined){\n            Global.ResourceMgr = cc.find(\"ResourceMgr\").getComponent(\"ResourceMgr\")\n            Global.ProtocolMgr = cc.find(\"ProtocolMgr\").getComponent(\"ProtocolMgr\")\n            Global.PageMgr = cc.find(\"PageMgr\").getComponent(\"PageMgr\")\n        }\n        this.list.forEach(e =>{\n            for(let i=0;i<72;i++){\n                let node = cc.instantiate(this.slot);\n                node.parent = e;\n                let num = dataFunc.randomNum(0,9);\n                let spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[num])\n                node.getChildByName('Icon').getComponent(cc.Sprite).spriteFrame = spriteFrame\n            }\n        })\n        this.winners = [];\n        this.clickState = 1;\n        this.currentWager = 0;\n        cc.director.GlobalEvent.on(\"updateWager\",this.updateWager,this);\n        cc.director.GlobalEvent.on('slotUserData',this.updateUserData,this)\n        Global.ProtocolMgr.slotUserData();\n        this.height = 0;\n        this.timer = 0;\n    },\n    updateWager(){\n        this.node.getChildByName('JiaZhu').getChildByName('BeiShu').getComponent(cc.Label).string = this.currentWager;\n    },\n    //增加投注倍数\n    addWager(){\n        if(this.clickState) {\n            this.currentWager += 5;\n            cc.director.GlobalEvent.emit('updateWager', {});\n        }\n    },\n    //减少投注倍数\n    minusWager(){\n        if(this.currentWager>=5&&this.clickState){\n            this.currentWager-=5;\n            cc.director.GlobalEvent.emit('updateWager',{});\n        }\n    },\n    updateUserData(){\n        this.node.getChildByName('User').getChildByName('value').getComponent(cc.Label).string = GameData.SlotUserData.dssc;\n    },\n    //延迟开始每一列的滚动动画\n    startSlot(){\n        if(this.clickState){\n            this.data = 0;\n            Global.ProtocolMgr.slotResult(this.currentWager,data=>{\n                if(data.code==200){\n                    this.data = data.data.rewardLevel;\n                    GameData.SlotUserData.dssc = data.data.amount;\n                    this.message = data.data.message\n                    //水果机启动后禁止点击\n                    this.clickState = 0;\n                    this.result = dataFunc.randomNum(0,8);\n                    this.num = dataFunc.randomNum(1,3);\n                    while(true){\n                        this.result2 = dataFunc.randomNum(0,8);\n                        if(this.result2!=this.result){\n                            break;\n                        }\n                    }\n                    this.numList = [];\n                    while (this.numList.length<3){\n                        let num = dataFunc.randomNum(0,9);\n                        if(this.numList.indexOf(num)==-1){\n                            this.numList.push(num);\n                        }\n                    }\n                    this.startAnim(this.list[0],0)\n                    cc.audioEngine.play(Global.ResourceMgr.slotClip[0],false,1)\n                    setTimeout(()=>{\n                        this.startAnim(this.list[1],1)\n                    },200)\n                    setTimeout(()=>{\n                        this.startAnim(this.list[2],2)\n                    },400)\n                }else{\n                    Global.PageMgr.showTipPage(data.message)\n                }\n            })\n        }else{\n            Global.PageMgr.showTipPage('游戏已开始')\n        }\n    },\n    start () {\n        GameData.audio = 1;\n    },\n    //水果机滚动动画\n    startAnim(list,tag){\n        list.y = 0;\n        let children = list.children;\n        let spriteFrame;\n        // 第一项结果值\n        if(this.data == 3){\n            //结果值\n            spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[9])\n        }else if(this.data==2){\n            //结果值\n            console.log('二等奖')\n            spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[this.result])\n        }else if(this.data==1){\n            //结果值\n            console.log('三等奖',Global.ResourceMgr.SlotTexture[this.result])\n            spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[this.result])\n            if(list.parent.name=='item'+this.num){\n                spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[this.result2])\n            }\n        }else{\n            spriteFrame = new cc.SpriteFrame(Global.ResourceMgr.SlotTexture[this.numList[tag]])\n        }\n        children[children.length-2].getChildByName('Icon').getComponent(cc.Sprite).spriteFrame = spriteFrame\n        let finish = ()=>{\n            if(tag===2){\n                cc.audioEngine.pauseAll();\n                if(this.data!==0){\n                    cc.audioEngine.play(Global.ResourceMgr.slotClip[1],false,1)\n                }else{\n                    cc.audioEngine.play(Global.ResourceMgr.slotClip[2],false,1)\n                }\n                this.clickState = 1;\n                this.updateUserData()\n                Global.PageMgr.showTipPage(this.message)\n            }\n        }\n        let action = cc.sequence(cc.moveBy(5,cc.v2(0,-list.height+540)).easing(cc.easeQuadraticActionInOut()),cc.callFunc(finish))\n        list.y = -270\n        list.runAction(action);\n    },\n    closeGames(){\n        // Global.ResourceMgr.playTransitionIn()\n        this.node.destroy()\n    },\n    onDestroy(){\n        cc.director.GlobalEvent.off(\"updateWager\")\n        cc.director.GlobalEvent.off('slotUserData')\n        cc.director.loadScene('Dssc',()=>{\n            Global.ResourceMgr.playBgAudio()\n            console.log('切换场景')\n        })\n    },\n    update (dt) {\n        if(this.Content.height>=275){\n            if(this.Content.y-150>=this.Content.height){\n                this.Content.y = 150;\n            }\n            this.Content.y+=dt*50;\n        }\n        this.timer+=dt;\n        if(this.timer>1){\n            this.timer = 0;\n            Global.ProtocolMgr.slotRecord((data)=>{\n                if(data.code==200){\n                    this.height = 0;\n                    let list = data.data;\n                    for(let i = list.length-1;i>this.winners.length-1;i--){\n                        let node = cc.instantiate(this.item);\n                        node.parent = this.Content;\n                        node.getChildByName('time').getComponent(cc.Label).string = list[i].time.substring(5,16);\n                        node.getChildByName('gain').getComponent(cc.Label).string = list[i].reward;\n                        node.getChildByName('phone').getComponent(cc.Label).string = list[i].nickname;\n                    }\n                    this.winners = list;\n                }\n            })\n        }\n    },\n});\n"]}