{"version":3,"sources":["HotUpdate.js"],"names":["cc","Class","extends","Component","properties","manifestUrl","type","Asset","default","infoLb","Label","searchPathsLb","_updating","_canRetry","_storagePath","checkCb","event","log","getEventCode","jsb","EventAssetsManager","ERROR_NO_LOCAL_MANIFEST","string","director","loadScene","ERROR_DOWNLOAD_MANIFEST","ERROR_PARSE_MANIFEST","ALREADY_UP_TO_DATE","NEW_VERSION_FOUND","scheduleOnce","hotUpdate","_am","setEventCallback","_checkListener","updateCb","needRestart","failed","UPDATE_PROGRESSION","msg","getMessage","getPercentByFile","console","UPDATE_FINISHED","UPDATE_FAILED","ERROR_UPDATING","ERROR_DECOMPRESS","_updateListener","searchPaths","fileUtils","getSearchPaths","newPaths","getLocalManifest","JSON","stringify","Array","prototype","unshift","apply","sys","localStorage","setItem","setSearchPaths","audioEngine","stopAll","game","restart","retry","downloadFailedAssets","checkUpdate","getState","AssetsManager","State","UNINITED","url","nativeUrl","loader","md5Pipe","transformURL","loadLocalManifest","isLoaded","bind","_failCount","update","onLoad","isNative","getWritablePath","versionCompareHandle","versionA","versionB","vA","split","vB","i","length","a","parseInt","b","self","setVerifyCallback","path","asset","compressed","expectedMD5","md5","relativePath","size","os","OS_ANDROID","setMaxConcurrentTask","onDestroy"],"mappings":"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","file":"HotUpdate.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["// pscp F:\\test\\hotupdate\\ver-1.0.5\\hotupdate.zip root@123.207.111.47:/var/www/html/wechatGame/test/\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        manifestUrl: {\n            type: cc.Asset,\n            default: null\n        },\n        infoLb : cc.Label,\n        searchPathsLb : cc.Label,\n        _updating: false,\n        _canRetry: false,\n        _storagePath: ''\n    },\n\n    checkCb: function (event) {\n        cc.log('Code: ' + event.getEventCode());\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.infoLb.string = \"本地没有发现manifest文件，跳过更新.\";\n                cc.director.loadScene('ECC');\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.infoLb.string = \"更新失败，跳过更新.\";\n                cc.director.loadScene('ECC');\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.infoLb.string = \"已经是最新版本,即将进入游戏.\";\n                cc.director.loadScene('ECC');\n                break;\n            case jsb.EventAssetsManager.NEW_VERSION_FOUND:\n                this.infoLb.string = '发现新版本,即将开始更新.';\n                this.scheduleOnce(this.hotUpdate, 1)\n                break;\n            default:\n                return;\n        }\n        \n        this._am.setEventCallback(null);\n        this._checkListener = null;\n        this._updating = false;\n    },\n\n    updateCb: function (event) {\n        var needRestart = false;\n        var failed = false;\n        switch (event.getEventCode())\n        {\n            case jsb.EventAssetsManager.ERROR_NO_LOCAL_MANIFEST:\n                this.infoLb.string = \"本地没有发现manifest文件，跳过更新.\";\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_PROGRESSION:\n                var msg = event.getMessage();\n                if (msg) {\n                    this.infoLb.string = '正在更新...';\n                    this.searchPathsLb.string = event.getPercentByFile() / 100 + \"%\";\n                    console.log(event.getPercentByFile() / 100 + '% : ' + msg);\n                }\n                break;\n            case jsb.EventAssetsManager.ERROR_DOWNLOAD_MANIFEST:\n            case jsb.EventAssetsManager.ERROR_PARSE_MANIFEST:\n                this.infoLb.string = \"更新失败，跳过更新.\";\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.ALREADY_UP_TO_DATE:\n                this.infoLb.string = \"已经是最新版本,即将进入游戏.\";\n                failed = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FINISHED:\n                this.infoLb.string = \"更新已完成，等待重启游戏.\";\n                needRestart = true;\n                break;\n            case jsb.EventAssetsManager.UPDATE_FAILED:\n                this.infoLb.string = \"更新失败，跳过更新.\";\n                this._updating = false;\n                this._canRetry = true;\n                cc.director.loadScene('ECC');\n                break;\n            case jsb.EventAssetsManager.ERROR_UPDATING:\n                this.infoLb.string = \"更新失败，跳过更新.\";\n                cc.director.loadScene('ECC');\n                break;\n            case jsb.EventAssetsManager.ERROR_DECOMPRESS:\n                this.infoLb.string = \"文件比对错误\";\n                break;\n            default:\n                break;\n        }\n\n        if (failed) {\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n            this._updating = false;\n            cc.director.loadScene('ECC');\n        }\n\n        if (needRestart) {\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n            // Prepend the manifest's search path\n            var searchPaths = jsb.fileUtils.getSearchPaths();\n            var newPaths = this._am.getLocalManifest().getSearchPaths();\n            console.log(JSON.stringify(newPaths));\n            Array.prototype.unshift.apply(searchPaths, newPaths);\n            // This value will be retrieved and appended to the default search path during game startup,\n            // please refer to samples/js-tests/main.js for detailed usage.\n            // !!! Re-add the search paths in main.js is very important, otherwise, new scripts won't take effect.\n            cc.sys.localStorage.setItem('HotUpdateSearchPaths', JSON.stringify(searchPaths));\n            jsb.fileUtils.setSearchPaths(searchPaths);\n\n            cc.audioEngine.stopAll();\n            cc.game.restart();\n        }\n    },\n    \n    retry: function () {\n        if (!this._updating && this._canRetry) {\n            this._canRetry = false;\n            \n            this.infoLb.string = '更新失败';\n            this._am.downloadFailedAssets();\n        }\n    },\n    \n    checkUpdate: function () {\n        if (this._updating) {\n            this.infoLb.string = '正在检查更新.';\n            return;\n        }\n        if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n            // Resolve md5 url\n            var url = this.manifestUrl.nativeUrl;\n            if (cc.loader.md5Pipe) {\n                url = cc.loader.md5Pipe.transformURL(url);\n            }\n            this._am.loadLocalManifest(url);\n        }\n        if (!this._am.getLocalManifest() || !this._am.getLocalManifest().isLoaded()) {\n            this.infoLb.string = \"本地没有发现manifest文件，跳过更新.\";\n            cc.director.loadScene('ECC');\n            return;\n        }\n        this._am.setEventCallback(this.checkCb.bind(this));\n\n        this._am.checkUpdate();\n        this._updating = true;\n    },\n\n    hotUpdate: function () {\n        if (this._am && !this._updating) {\n            this._am.setEventCallback(this.updateCb.bind(this));\n\n            if (this._am.getState() === jsb.AssetsManager.State.UNINITED) {\n                // Resolve md5 url\n                var url = this.manifestUrl.nativeUrl;\n                if (cc.loader.md5Pipe) {\n                    url = cc.loader.md5Pipe.transformURL(url);\n                }\n                this._am.loadLocalManifest(url);\n            }\n\n            this._failCount = 0;\n            this._am.update();\n            this._updating = true;\n        }\n    },\n   \n    // use this for initialization\n    onLoad: function () {\n        // Hot update is only available in Native build\n        if (!cc.sys.isNative) {\n            cc.director.loadScene('ECC');\n            return;\n        }\n        // this.searchPathsLb.string = jsb.fileUtils.getSearchPaths()\n\n        this._storagePath = ((jsb.fileUtils ? jsb.fileUtils.getWritablePath() : '/') + 'blackjack-remote-asset');\n        cc.log('Storage path for remote asset : ' + this._storagePath);\n// cc.log('SearchPaths:' + jsb.fileUtils.getSearchPaths())\n        // Setup your own version compare handler, versionA and B is versions in string\n        // if the return value greater than 0, versionA is greater than B,\n        // if the return value equals 0, versionA equals to B,\n        // if the return value smaller than 0, versionA is smaller than B.\n        this.versionCompareHandle = function (versionA, versionB) {\n            cc.log(\"JS Custom Version Compare: version A is \" + versionA + ', version B is ' + versionB);\n            var vA = versionA.split('.');\n            var vB = versionB.split('.');\n            for (var i = 0; i < vA.length; ++i) {\n                var a = parseInt(vA[i]);\n                var b = parseInt(vB[i] || 0);\n                if (a === b) {\n                    continue;\n                }\n                else {\n                    return a - b;\n                }\n            }\n            if (vB.length > vA.length) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        };\n\n        // Init with empty manifest url for testing custom manifest\n        this._am = new jsb.AssetsManager('', this._storagePath, this.versionCompareHandle);\n\n        var self = this;\n        this.infoLb.string = '正在检查更新.';\n        // Setup the verification callback, but we don't have md5 check function yet, so only print some message\n        // Return true if the verification passed, otherwise return false\n        this._am.setVerifyCallback(function (path, asset) {\n            // When asset is compressed, we don't need to check its md5, because zip file have been deleted.\n            var compressed = asset.compressed;\n            // Retrieve the correct md5 value.\n            var expectedMD5 = asset.md5;\n            // asset.path is relative path and path is absolute.\n            var relativePath = asset.path;\n            // The size of asset file, but this value could be absent.\n            var size = asset.size;\n            if (compressed) {\n                // self.infoLb.string = \"Verification passed : \" + relativePath;\n                return true;\n            }\n            else {\n                // self.infoLb.string = \"Verification passed : \" + relativePath + ' (' + expectedMD5 + ')';\n                return true;\n            }\n        });\n\n        \n\n        if (cc.sys.os === cc.sys.OS_ANDROID) {\n            // Some Android device may slow down the download process when concurrent tasks is too much.\n            // The value may not be accurate, please do more test and find what's most suitable for your game.\n            this._am.setMaxConcurrentTask(2);\n            // this.infoLb.string = \"Max concurrent tasks count have been limited to 2\";\n        }\n\n        this.scheduleOnce(this.checkUpdate, 1)\n    },\n\n    onDestroy: function () {\n        if (this._updateListener) {\n            this._am.setEventCallback(null);\n            this._updateListener = null;\n        }\n    }\n});\n"]}