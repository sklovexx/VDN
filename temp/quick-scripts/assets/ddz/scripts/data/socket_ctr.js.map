{"version":3,"sources":["socket_ctr.js"],"names":["socketCtr","that","respone_map","call_index","_socket","event","_sendmsg","cmdtype","req","callindex","emit","cmd","data","_request","callback","console","log","JSON","stringify","initSocket","opts","window","io","connect","defines","serverUrl","on","cc","director","GlobalEvent","res","type","hasOwnProperty","callBackIndex","result","fire","request_wxLogin","login","request_creatroom","request_jion","request_enter_room","request_buchu_card","request_chu_card","request_quit_room","onPlayerJoinRoom","onPlayerReady","onGameStart","onChangeHouseManage","requestReady","requestStart","requestConfig","requestRobState","state","onPushCards","onCanRobState","onRobState","onChangeMaster","onShowBottomCard","onBeiShuUpdate","onCanChuCard","onRoomChangeState","onQuitPlayer","onGameResult","onOtherPlayerChuCard","oninterval","onendInterval","disconnect","clearEvent","removeAllLister"],"mappings":"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","file":"socket_ctr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\ddz\\scripts\\data","sourcesContent":["import eventlister from \"../util/event_lister.js\"\n\nconst socketCtr = function(){\n    var that = {}\n    var respone_map = {} \n    var call_index = 0\n\n    var _socket = null\n    var event = eventlister({})\n    const _sendmsg = function(cmdtype,req,callindex){\n        _socket.emit(\"notify\",{cmd:cmdtype,data:req,callindex:callindex})\n    } \n \n    const _request = function(cmdtype,req,callback){\n        console.log(\"send cmd:\"+cmdtype+\"  \"+ JSON.stringify(req))\n        call_index++ \n        respone_map[call_index] = callback\n        _sendmsg(cmdtype,req,call_index)\n    } \n  \n        \n    that.initSocket = function(){\n        var opts = {\n            'reconnection':false,\n            'force new connection': true,\n            'transports':['websocket', 'polling']\n        }\n        _socket = window.io.connect(defines.serverUrl,opts);\n\n        _socket.on(\"connection\",function(){\n            console.log(\"connect server success!!\")\n            cc.director.GlobalEvent.emit('connected')\n          })\n\n       _socket.on(\"notify\",function(res){\n            if(res.type!='interval'){\n                console.log(\"on notify cmd:\" + JSON.stringify(res))\n            }\n         \n         if(respone_map.hasOwnProperty(res.callBackIndex)){\n           var callback = respone_map[res.callBackIndex]\n           if(callback){\n               callback(res.result,res.data)\n           }\n          }else{\n           //if(res.callBackIndex!=0){\n           //console.log(\"not found call index\",res.callBackIndex)\n              \n               //提交一个监听的事件给监听器\n        //  on notify cmd:{\"type\":\"player_joinroom_notify\",\"result\":0,\"data\":\n        //  {\"accountid\":\"2586422\",\"nick_name\":\"tiny110\",\"avatarUrl\":\n        //  \"avatar_3\",\"goldcount\":1000,\"seatindex\":2},\"callBackIndex\":null}\n              //没有找到回到函数，就给事件监听器提交一个事件\n              var type = res.type\n              event.fire(type,res.data)\n          // }\n           \n         }\n\n        })\n\n    }\n\n    that.request_wxLogin = function(req,callback){\n        _request(\"wxlogin\",req,callback)\n    }\n    that.login = function(req,callback){\n        _request(\"login\",req,callback)\n    }\n    that.request_creatroom = function(req,callback){\n        _request(\"createroom_req\",req,callback)\n    }\n\n    that.request_jion = function(req,callback){\n        _request(\"joinroom_req\",req,callback)\n    }\n\n    that.request_enter_room = function(req,callback){\n        _request(\"enterroom_req\",req,callback)\n    }\n\n    //发送不出牌信息\n    that.request_buchu_card =  function(req,callback){\n        _request(\"chu_bu_card_req\",req,callback)\n    }\n    /*玩家出牌\n      需要判断: \n         出的牌是否符合规则\n         和上个出牌玩家比较，是否满足条件\n\n    */\n    that.request_chu_card = function(req,callback){\n        _request(\"chu_card_req\",req,callback)\n    }\n    that.request_quit_room = function(req,callback){\n        _request(\"quitroom_req\",req,callback)\n    }\n    //监听其他玩家进入房间消息\n    that.onPlayerJoinRoom = function(callback){\n         event.on(\"player_joinroom_notify\",callback)\n    }\n\n    that.onPlayerReady = function(callback){\n        event.on(\"player_ready_notify\",callback)\n    }\n\n    that.onGameStart = function(callback){\n        if(callback){\n           event.on(\"gameStart_notify\",callback)\n        }\n    }\n\n    that.onChangeHouseManage = function(callback){\n        if(callback){\n            event.on(\"changehousemanage_notify\",callback)\n        }\n    }\n    //发送ready消息\n    that.requestReady = function(callback){\n        _sendmsg(\"player_ready_notify\",{},callback)\n    }\n    that.requestStart = function(callback){\n        _request(\"player_start_notify\",{},callback)\n    }\n    that.requestConfig = function(callback){\n        _request(\"config_req\",{},callback)\n    }\n    //玩家通知服务器抢地主消息\n    that.requestRobState = function(state){\n        _sendmsg(\"player_rob_notify\",state,null)\n    }\n    //服务器下发牌通知\n    that.onPushCards = function(callback){\n        if(callback){\n            event.on(\"pushcard_notify\",callback)\n         }\n    }\n\n    //监听服务器通知开始抢地主消息\n    that.onCanRobState = function(callback){\n        if(callback){\n            event.on(\"canrob_notify\",callback)\n         }\n    }\n\n    //监听服务器:通知谁抢地主操作消息\n    that.onRobState = function(callback){\n        if(callback){\n            event.on(\"canrob_state_notify\",callback)\n         }\n    }\n\n    //监听服务器:确定地主消息\n    that.onChangeMaster = function(callback){\n        if(callback){\n            event.on(\"change_master_notify\",callback)\n         }\n    }\n\n    //监听服务器:显示底牌消息\n    that.onShowBottomCard = function(callback){\n        if(callback){\n            event.on(\"change_showcard_notify\",callback)\n         }\n    }\n    that.onBeiShuUpdate = function(callback){\n        if(callback){\n            event.on(\"curr_multiple_refresh_notify\",callback)\n        }\n    }\n    //监听服务器:可以出牌消息\n    that.onCanChuCard = function(callback){\n        if(callback){\n            event.on(\"can_chu_card_notify\",callback)\n        }\n    }\n\n    that.onRoomChangeState = function(callback){\n        if(callback){\n            event.on(\"room_state_notify\",callback)\n        }\n    }\n    that.onQuitPlayer = function(callback){\n        if(callback){\n            event.on(\"quit_player\",callback)\n        }\n    }\n    that.onGameResult = function(callback){\n        if(callback){\n            event.on(\"curr_settlement_result\",callback)\n        }\n    }\n    that.onOtherPlayerChuCard = function(callback){\n        if(callback){\n            event.on(\"curr_chucard_notify\",callback)\n        }\n    }\n    that.oninterval = function(callback){\n        if(callback){\n            event.on(\"interval\",callback)\n        }\n    }\n    that.onendInterval = function(callback){\n        if(callback){\n            event.on(\"endInterval\",callback)\n        }\n    }\n    that.disconnect = function(callback){\n        if(callback){\n            event.on(\"disconnect\",callback)\n        }\n    }\n    that.clearEvent = function(){\n        event.removeAllLister()\n    }\n    \n    return that\n}\n\nexport default socketCtr "]}