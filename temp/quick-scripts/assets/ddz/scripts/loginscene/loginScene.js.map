{"version":3,"sources":["loginScene.js"],"names":["cc","Class","extends","Component","properties","wait_node","Node","tipsLabel","Label","loginBg","default","type","AudioClip","onLoad","audioEngine","play","director","GlobalEvent","on","myglobal","socket","login","token","GetQueryVariable","err","result","console","log","string","setTimeout","bind","JSON","stringify","playerData","gobal_count","goldCount","accountID","avatarUrl","nickName","loadScene","initSocket","start","onButtonCilck","event","customData","variable","query","window","location","search","substring","vars","split","i","length","pair"],"mappings":";;;;;;AAAA;;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACTC,mBAAUL,GAAGM,IADJ;AAETC,mBAAUP,GAAGQ,KAFJ,EAEW;AACpBC,iBAAQ;AACPC,qBAAQ,IADD;AAEPC,kBAAKX,GAAGY;AAFD;AAHC,KAHP;;AAYL;;AAEAC,UAdK,oBAcK;AAAA;;AACN;AACA,YAAG,IAAH,EAAQ;AACJb,eAAGc,WAAH,CAAeC,IAAf,CAAoB,KAAKN,OAAzB,EAAiC,IAAjC;AACH;AACDT,WAAGgB,QAAH,CAAYC,WAAZ,CAAwBC,EAAxB,CAA2B,WAA3B,EAAuC,YAAI;AACvCC,+BAASC,MAAT,CAAgBC,KAAhB,CAAsB;AAClBC,uBAAM,MAAKC,gBAAL,CAAsB,OAAtB;AADY,aAAtB,EAEE,UAASC,GAAT,EAAaC,MAAb,EAAoB;AAClB;AACA;AACA;AACA,oBAAGD,OAAK,CAAR,EAAU;AACPE,4BAAQC,GAAR,CAAY,SAAOH,GAAnB;AACA,yBAAKjB,SAAL,CAAeqB,MAAf,GAAsBH,MAAtB;AACAI,+BAAW,YAAU;AACjB,6BAAKtB,SAAL,CAAeqB,MAAf,GAAsB,EAAtB;AACH,qBAFU,CAETE,IAFS,CAEJ,IAFI,CAAX,EAEc,IAFd;AAGA;AACF;;AAEDJ,wBAAQC,GAAR,CAAY,iBAAiBI,KAAKC,SAAL,CAAeP,MAAf,CAA7B;AACAC,wBAAQC,GAAR,CAAYF,MAAZ;AACAN,mCAASc,UAAT,CAAoBC,WAApB,GAAkCT,OAAOU,SAAzC;AACAhB,mCAASc,UAAT,CAAoBG,SAApB,GAAgCX,OAAOW,SAAvC;AACAjB,mCAASc,UAAT,CAAoBI,SAApB,GAAgCZ,OAAOY,SAAvC;AACAlB,mCAASc,UAAT,CAAoBK,QAApB,GAA+Bb,OAAOa,QAAtC;AACAtC,mBAAGgB,QAAH,CAAYuB,SAAZ,CAAsB,WAAtB;AACH,aApBC,CAoBAT,IApBA,OAFF;AAuBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACH,SA1CD,EA0CE,IA1CF;AA2CAX,2BAASC,MAAT,CAAgBoB,UAAhB;AACH,KA/DI;AAiELC,SAjEK,mBAiEI,CAER,CAnEI;AAqELC,iBArEK,yBAqESC,KArET,EAqEeC,UArEf,EAqE0B;AAC3B,gBAAOA,UAAP;AACI,iBAAK,UAAL;AACIlB,wBAAQC,GAAR,CAAY,kBAAZ;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACJ;AACI;AA3BR;AA6BH,KAnGI;;AAoGLJ,sBAAiB,0BAASsB,QAAT,EACjB;AACI,YAAIC,QAAQC,OAAOC,QAAP,CAAgBC,MAAhB,CAAuBC,SAAvB,CAAiC,CAAjC,CAAZ;AACA,YAAIC,OAAOL,MAAMM,KAAN,CAAY,GAAZ,CAAX;AACA,aAAK,IAAIC,IAAE,CAAX,EAAaA,IAAEF,KAAKG,MAApB,EAA2BD,GAA3B,EAAgC;AAC5B,gBAAIE,OAAOJ,KAAKE,CAAL,EAAQD,KAAR,CAAc,GAAd,CAAX;AACA,gBAAGG,KAAK,CAAL,KAAWV,QAAd,EAAuB;AAAC,uBAAOU,KAAK,CAAL,CAAP;AAAgB;AAC3C;AACD,eAAO,KAAP;AACH;AACD;;;AA9GK,CAAT","file":"loginScene.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\ddz\\scripts\\loginscene","sourcesContent":["import myglobal from \"../mygolbal.js\"\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       wait_node:cc.Node,\r\n       tipsLabel:cc.Label, //tips\r\n       loginBg:{\r\n        default:null,\r\n        type:cc.AudioClip\r\n    }\r\n    },\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        //console.log(\"qian_state.qian:\"+ qian_state.qian)\r\n        if(true){\r\n            cc.audioEngine.play(this.loginBg,true) \r\n        }\r\n        cc.director.GlobalEvent.on('connected',()=>{\r\n            myglobal.socket.login({\r\n                token:this.GetQueryVariable('token')\r\n            },function(err,result){\r\n                //请求返回\r\n                //先隐藏等待UI\r\n                //this.wait_node.active = false\r\n                if(err!=0){\r\n                   console.log(\"err:\"+err)\r\n                   this.tipsLabel.string=result\r\n                   setTimeout(function(){\r\n                       this.tipsLabel.string=\"\"\r\n                   }.bind(this), 2000);\r\n                   return     \r\n                }\r\n \r\n                console.log(\"login sucess\" + JSON.stringify(result))\r\n                console.log(result)\r\n                myglobal.playerData.gobal_count = result.goldCount\r\n                myglobal.playerData.accountID = result.accountID\r\n                myglobal.playerData.avatarUrl = result.avatarUrl\r\n                myglobal.playerData.nickName = result.nickName\r\n                cc.director.loadScene(\"hallScene\")\r\n            }.bind(this))\r\n            // myglobal.socket.request_wxLogin({\r\n            //     uniqueID:myglobal.playerData.uniqueID,\r\n            //     accountID:myglobal.playerData.accountID,\r\n            //     nickName:myglobal.playerData.nickName,\r\n            //     avatarUrl:myglobal.playerData.avatarUrl,\r\n            // },function(err,result){\r\n            //     //请求返回\r\n            //     //先隐藏等待UI\r\n            //     //this.wait_node.active = false\r\n            //     if(err!=0){\r\n            //        console.log(\"err:\"+err)\r\n            //        return     \r\n            //     }\r\n\r\n            //     console.log(\"login sucess\" + JSON.stringify(result))\r\n            //     myglobal.playerData.gobal_count = result.goldcount\r\n            //     cc.director.loadScene(\"hallScene\")\r\n            // }.bind(this))\r\n        },this)\r\n        myglobal.socket.initSocket()\r\n    },\r\n    \r\n    start () {\r\n        \r\n    },\r\n    \r\n    onButtonCilck(event,customData){\r\n        switch(customData){\r\n            case \"wx_login\":\r\n                console.log(\"wx_login request\")\r\n                \r\n                //this.wait_node.active = true\r\n                \r\n                // myglobal.socket.login({\r\n                //     token:this.GetQueryVariable('token')\r\n                // },function(err,result){\r\n                //     //请求返回\r\n                //     //先隐藏等待UI\r\n                //     //this.wait_node.active = false\r\n                //     if(err!=0){\r\n                //        console.log(\"err:\"+err)\r\n                //        this.tipsLabel.string=result.data\r\n                //        setTimeout(function(){\r\n                //            this.tipsLabel.string=\"\"\r\n                //        }.bind(this), 2000);\r\n                //        return     \r\n                //     }\r\n\r\n                //     console.log(\"login sucess\" + JSON.stringify(result))\r\n                //     myglobal.playerData.gobal_count = result.goldcount\r\n                //     cc.director.loadScene(\"hallScene\")\r\n                // }.bind(this))\r\n                break\r\n            default:\r\n                break\r\n        }\r\n    },\r\n    GetQueryVariable:function(variable)\r\n    {\r\n        let query = window.location.search.substring(1);\r\n        let vars = query.split(\"&\");\r\n        for (let i=0;i<vars.length;i++) {\r\n            let pair = vars[i].split(\"=\");\r\n            if(pair[0] == variable){return pair[1];}\r\n        }\r\n        return(false);\r\n    },\r\n    // update (dt) {},\r\n\r\n\r\n});\r\n"]}