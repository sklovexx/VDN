{"version":3,"sources":["GameWebSocket.js"],"names":["GameWebSocketState","cc","Enum","CONNECTING","OPEN","CLOSING","CLOSED","GameWebSocketDelegate","Class","onSocketOpen","onSocketMessage","data","onSocketError","onSocketClosed","reason","GameWebSocketInterface","connect","send","close","getState","GameWebSocket","extends","properties","_address","_delegate","_webSocket","init","address","delegate","log","ws","WebSocket","onopen","bind","onmessage","param","onerror","onclose","stringOrBinary","err","toString","readyState","module","exports"],"mappings":";;;;;;AAAA;;;AAGA,IAAIA,qBAAqBC,GAAGC,IAAH,CAAQ;AAC7BC,gBAAY,CADiB;AAE7BC,UAAM,CAFuB;AAG7BC,aAAS,CAHoB;AAI7BC,YAAQ;AAJqB,CAAR,CAAzB;;AAOA;;;AAGA,IAAIC,wBAAwBN,GAAGO,KAAH,CAAS;;AAEjCC,kBAAc,wBAAY,CAEzB,CAJgC;;AAMjC;;;;AAIAC,qBAAiB,yBAAUC,IAAV,EAAgB,CAEhC,CAZgC;;AAcjCC,mBAAe,yBAAY,CAE1B,CAhBgC;;AAkBjC;;;;AAIAC,oBAAgB,wBAAUC,MAAV,EAAkB,CAEjC;AAxBgC,CAAT,CAA5B;;AA2BA;;;AAGA,IAAIC,yBAAyBd,GAAGO,KAAH,CAAS;;AAElCQ,aAAS,mBAAY,CAEpB,CAJiC;;AAMlCC,UAAM,gBAAY,CAEjB,CARiC;;AAUlCC,WAAO,iBAAY,CAElB,CAZiC;;AAclCC,cAAU,oBAAY,CAErB;AAhBiC,CAAT,CAA7B;;AAmBA,IAAIC,gBAAgBnB,GAAGO,KAAH,CAAS;AACzBa,aAASN,sBADgB;;AAGzBO,gBAAY;;AAER;;;AAGAC,kBAAU,IALF;;AAOR;;;AAGAC,mBAAW,IAVH;;AAYR;;;AAGAC,oBAAY;AAfJ,KAHa;;AAqBzB;;;;AAIAC,UAAM,cAASC,OAAT,EAAkBC,QAAlB,EAA2B;AAC7B,aAAKL,QAAL,GAAgBI,OAAhB;AACA,aAAKH,SAAL,GAAiBI,QAAjB;AACA,aAAKH,UAAL,GAAkB,IAAlB;AACH,KA7BwB;;AA+BzBT,aAAS,mBAAY;AACjBf,WAAG4B,GAAH,CAAO,gBAAe,KAAKN,QAA3B;;AAEA,YAAIO,KAAK,KAAKL,UAAL,GAAkB,IAAIM,SAAJ,CAAc,KAAKR,QAAnB,CAA3B;AACAO,WAAGE,MAAH,GAAY,KAAKR,SAAL,CAAef,YAAf,CAA4BwB,IAA5B,CAAiC,KAAKT,SAAtC,CAAZ;AACAM,WAAGI,SAAH,GAAe,UAAUC,KAAV,EAAiB;AAC5B,iBAAKX,SAAL,CAAed,eAAf,CAA+ByB,MAAMxB,IAArC;AACH,SAFc,CAEbsB,IAFa,CAER,IAFQ,CAAf;AAGAH,WAAGM,OAAH,GAAa,KAAKZ,SAAL,CAAeZ,aAAf,CAA6BqB,IAA7B,CAAkC,KAAKT,SAAvC,CAAb;AACA;AACAM,WAAGO,OAAH,GAAa,UAAUF,KAAV,EAAiB;AAC1B,iBAAKX,SAAL,CAAeX,cAAf,CAA8BsB,MAAMrB,MAApC;AACH,SAFY,CAEXmB,IAFW,CAEN,IAFM,CAAb;AAGH,KA5CwB;;AA8CzB;;;;AAIAhB,UAAM,cAAUqB,cAAV,EAA0B;AAC5B,aAAKb,UAAL,CAAgBR,IAAhB,CAAqBqB,cAArB;AACH,KApDwB;;AAsDzBpB,WAAO,iBAAY;AACf,YAAI,CAAC,KAAKO,UAAV,EAAsB;AAClB;AACH;;AAED,YAAI;AACA,iBAAKA,UAAL,CAAgBP,KAAhB;AACH,SAFD,CAEE,OAAOqB,GAAP,EAAY;AACVtC,eAAG4B,GAAH,CAAO,+BAAP,EAAwCU,IAAIC,QAAJ,EAAxC;AACH;AACD,aAAKf,UAAL,GAAkB,IAAlB;AACH,KAjEwB;;AAmEzBN,cAAU,oBAAY;AAClB,YAAI,KAAKM,UAAT,EAAqB;AACjB,oBAAO,KAAKA,UAAL,CAAgBgB,UAAvB;AACI,qBAAKV,UAAU3B,IAAf;AACI,2BAAOJ,mBAAmBI,IAA1B;AACJ,qBAAK2B,UAAU5B,UAAf;AACI,2BAAOH,mBAAmBG,UAA1B;AACJ,qBAAK4B,UAAU1B,OAAf;AACI,2BAAOL,mBAAmBK,OAA1B;AACJ,qBAAK0B,UAAUzB,MAAf;AACI,2BAAON,mBAAmBM,MAA1B;AARR;AAUH;AACD,eAAON,mBAAmBM,MAA1B;AACH;AAjFwB,CAAT,CAApB;;AAoFAoC,OAAOC,OAAP,GAAiB;AACb3C,wBAAoBA,kBADP;AAEbO,2BAAuBA,qBAFV;AAGbQ,4BAAwBA,sBAHX;AAIbK,mBAAeA;AAJF,CAAjB","file":"GameWebSocket.js","sourceRoot":"..\\..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\net\\socket","sourcesContent":["/**\r\n * @enum {number}\r\n */\r\nvar GameWebSocketState = cc.Enum({\r\n    CONNECTING: 1,\r\n    OPEN: 2,\r\n    CLOSING: 3,\r\n    CLOSED: 4\r\n});\r\n\r\n/**\r\n * @interface\r\n */\r\nvar GameWebSocketDelegate = cc.Class({\r\n\r\n    onSocketOpen: function () {\r\n\r\n    },\r\n\r\n    /**\r\n     * 收到了消息\r\n     * @param {string|Uint8Array} data\r\n     */\r\n    onSocketMessage: function (data) {\r\n\r\n    },\r\n\r\n    onSocketError: function () {\r\n\r\n    },\r\n\r\n    /**\r\n     * 连接关闭\r\n     * @param {string} reason\r\n     */\r\n    onSocketClosed: function (reason) {\r\n\r\n    }\r\n});\r\n\r\n/**\r\n * @interface\r\n */\r\nvar GameWebSocketInterface = cc.Class({\r\n\r\n    connect: function () {\r\n\r\n    },\r\n\r\n    send: function () {\r\n\r\n    },\r\n\r\n    close: function () {\r\n\r\n    },\r\n\r\n    getState: function () {\r\n\r\n    }\r\n});\r\n\r\nvar GameWebSocket = cc.Class({\r\n    extends: GameWebSocketInterface,\r\n\r\n    properties: {\r\n\r\n        /**\r\n         * @type {String} 服务器地址\r\n         */\r\n        _address: null,\r\n\r\n        /**\r\n         * @type {GameWebSocketDelegate}\r\n         */\r\n        _delegate: null,\r\n\r\n        /**\r\n         * @type {WebSocket}\r\n         */\r\n        _webSocket: null,\r\n    },\r\n\r\n    /**\r\n     * @param {string} address 服务器地址\r\n     * @param {GameWebSocketDelegate} delegate 回调接口\r\n     */\r\n    init: function(address, delegate){\r\n        this._address = address;\r\n        this._delegate = delegate;\r\n        this._webSocket = null;\r\n    },\r\n\r\n    connect: function () {\r\n        cc.log('connect to '+ this._address);\r\n\r\n        var ws = this._webSocket = new WebSocket(this._address);\r\n        ws.onopen = this._delegate.onSocketOpen.bind(this._delegate);\r\n        ws.onmessage = function (param) {\r\n            this._delegate.onSocketMessage(param.data);\r\n        }.bind(this);\r\n        ws.onerror = this._delegate.onSocketError.bind(this._delegate);\r\n        // function({code: Number, reason: String, wasClean: Boolean})}\r\n        ws.onclose = function (param) {\r\n            this._delegate.onSocketClosed(param.reason);\r\n        }.bind(this);\r\n    },\r\n\r\n    /**\r\n     * 发送数据\r\n     * @param {string|Uint8Array} stringOrBinary\r\n     */\r\n    send: function (stringOrBinary) {\r\n        this._webSocket.send(stringOrBinary);\r\n    },\r\n\r\n    close: function () {\r\n        if (!this._webSocket) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            this._webSocket.close();\r\n        } catch (err) {\r\n            cc.log('error while closing webSocket', err.toString());\r\n        }\r\n        this._webSocket = null;\r\n    },\r\n\r\n    getState: function () {\r\n        if (this._webSocket) {\r\n            switch(this._webSocket.readyState){\r\n                case WebSocket.OPEN:\r\n                    return GameWebSocketState.OPEN;\r\n                case WebSocket.CONNECTING:\r\n                    return GameWebSocketState.CONNECTING;\r\n                case WebSocket.CLOSING:\r\n                    return GameWebSocketState.CLOSING;\r\n                case WebSocket.CLOSED:\r\n                    return GameWebSocketState.CLOSED;\r\n            }\r\n        }\r\n        return GameWebSocketState.CLOSED;\r\n    }\r\n});\r\n\r\nmodule.exports = {\r\n    GameWebSocketState: GameWebSocketState,\r\n    GameWebSocketDelegate: GameWebSocketDelegate,\r\n    GameWebSocketInterface: GameWebSocketInterface,\r\n    GameWebSocket: GameWebSocket\r\n};"]}