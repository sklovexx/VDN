{"version":3,"sources":["SettingViewCtrl.js"],"names":["DataMgr","require","ViewBase","AlertView","FacebookMgr","ServerProxy","Switch","UtilsCross","cc","Class","extends","properties","btnFb","Button","labelName","Label","icon","Node","switchMusic","switchEff","onLoad","settingData","getInstance","settingObj","isOn","musicOn","effectOn","isLogin","playerObj","fbid","interactable","node","getChildByName","active","fbicon","log","getComponent","loadTexture","fbname","string","onEnable","GlobalNiuNiu","eventMgr","on","config","EVENT_BIND_FB_SUC","onBindFbSuc","onDisable","off","start","EVENT_UPDATE_FB_ICON","EVENT_UPDATE_FB_NAME","onBtnMusic","event","audioMgr","playLastMusic","stopMusic","playEffect","effBtnClick","onBtnEff","stopAllEffects","onBtnFb","self","gameMgr","loginFb","onBtnTerms","sys","openURL","onBtnRateUs","onBtnShare","title","bestScore","Math","floor","url","extraText","js","formatStr","share","onBtnRestore","IapTools","restorePurchase","err","onBtnPrivacy"],"mappings":"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","file":"SettingViewCtrl.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\views","sourcesContent":["/**\r\n * Created by skyxu on 2018/6/11.\r\n */\r\n\r\n\"use strict\";\r\n\r\nlet DataMgr = require(\"./../common/DataMgr\");\r\nlet ViewBase = require(\"./../common/ViewBase\");\r\nlet AlertView = require(\"./../views/DialogCtrl\");\r\nlet FacebookMgr = require(\"./../common/FacebookMgr\");\r\nlet ServerProxy = require(\"./../net/HttpProxy\");\r\nlet Switch = require(\"./../common/SwitchControl\");\r\nlet UtilsCross = require(\"./../common/UtilsCross\");\r\n\r\ncc.Class({\r\n    extends: ViewBase,\r\n\r\n    properties: {\r\n        btnFb: cc.Button,\r\n        labelName: cc.Label,\r\n        icon: cc.Node,\r\n        switchMusic: Switch,\r\n        switchEff: Switch,\r\n\r\n    },\r\n\r\n    onLoad(){\r\n        // todo: 更新按钮状态\r\n        let settingData = DataMgr.getInstance().settingObj;\r\n        this.switchMusic.isOn = settingData.musicOn;\r\n        this.switchEff.isOn = settingData.effectOn;\r\n\r\n        if (FacebookMgr.getInstance().isLogin() && DataMgr.getInstance().playerObj.fbid > 0 && this.btnFb){\r\n            this.btnFb.interactable = false;\r\n            this.btnFb.node.getChildByName(\"giftAniNode\").active = false;\r\n        }\r\n\r\n        let fbicon = DataMgr.getInstance().playerObj.fbicon;\r\n        cc.log(\"已保存fbicon: \" + fbicon);\r\n        if (fbicon !== \"\"){\r\n            this.icon.getComponent(\"IconNodeCtrl\").loadTexture(fbicon);\r\n        }\r\n\r\n        let fbname = DataMgr.getInstance().playerObj.fbname;\r\n        cc.log(\"已保存fbname: \" + fbname);\r\n        if (fbname !== \"\"){\r\n            this.labelName.string = fbname;\r\n        }\r\n    },\r\n\r\n    onEnable(){\r\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_BIND_FB_SUC, this.onBindFbSuc, this);\r\n\r\n    },\r\n\r\n    onDisable(){\r\n        GlobalNiuNiu.eventMgr.off(GlobalNiuNiu.config.EVENT_BIND_FB_SUC, this.onBindFbSuc, this);\r\n    },\r\n\r\n    start(){\r\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_UPDATE_FB_ICON, ()=>{\r\n            let fbicon = DataMgr.getInstance().playerObj.fbicon;\r\n            if (fbicon !== \"\"){\r\n                this.icon.getComponent(\"IconNodeCtrl\").loadTexture(fbicon);\r\n            }\r\n        }, this);\r\n        GlobalNiuNiu.eventMgr.on(GlobalNiuNiu.config.EVENT_UPDATE_FB_NAME, ()=>{\r\n            let fbname = DataMgr.getInstance().playerObj.fbname;\r\n            if (fbname !== \"\"){\r\n                this.labelName.string = fbname;\r\n            }\r\n        }, this);\r\n    },\r\n\r\n    onBindFbSuc(){\r\n        this.btnFb.interactable = false;\r\n        this.btnFb.node.getChildByName(\"giftAniNode\").active = false;\r\n    },\r\n\r\n    onBtnMusic(event){\r\n        let settingData = DataMgr.getInstance().settingObj;\r\n\r\n        let isOn = settingData.musicOn;\r\n        isOn = !isOn;\r\n        settingData.musicOn = isOn;\r\n\r\n        if (isOn){\r\n            GlobalNiuNiu.audioMgr.playLastMusic();\r\n        }else {\r\n            GlobalNiuNiu.audioMgr.stopMusic();\r\n        }\r\n\r\n        this.switchMusic.isOn = isOn;\r\n\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n    },\r\n\r\n    onBtnEff(event){\r\n        let settingData = DataMgr.getInstance().settingObj;\r\n\r\n        let isOn = settingData.effectOn;\r\n        isOn = !isOn;\r\n        settingData.effectOn = isOn;\r\n\r\n        if (!isOn){\r\n            GlobalNiuNiu.audioMgr.stopAllEffects();\r\n        }\r\n\r\n        this.switchEff.isOn = isOn;\r\n\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n    },\r\n\r\n    onBtnFb(){\r\n        let self = this;\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n        GlobalNiuNiu.gameMgr.loginFb();\r\n    },\r\n\r\n    onBtnTerms(){\r\n        cc.sys.openURL(\"https://www.baidu.com\");\r\n\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n    },\r\n\r\n    onBtnRateUs(){\r\n        cc.log('rate us...');\r\n        cc.sys.openURL(\"https://play.google.com/store/apps/details?id=com.hawk.bouncestarblast\");\r\n\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n    },\r\n\r\n    onBtnShare(){\r\n        cc.log('share...');\r\n        let title = \"Share\";\r\n        let bestScore = Math.floor(DataMgr.getInstance().playerObj.bestScore);\r\n        let url = \"https://play.google.com/store/apps/details?id=com.hawk.bouncestarblast\";\r\n        let extraText = cc.js.formatStr(\"It's funny,my best score is %d,try to challenge me!   %s\", bestScore, url);\r\n        UtilsCross.share(title, extraText);\r\n    },\r\n\r\n    onBtnRestore(){\r\n        cc.log('restore...');\r\n        IapTools.restorePurchase(()=>{\r\n            cc.log('js restore suc.');\r\n        }, (err)=>{\r\n            cc.log('js restore failed.');\r\n        });\r\n    },\r\n\r\n    onBtnPrivacy(){\r\n        cc.sys.openURL(\"http://tcl-icloudcdn.tclclouds.com/cloudSecurityBackend/game/201805/Privacy-Policy.html\");\r\n\r\n        GlobalNiuNiu.audioMgr.playEffect(GlobalNiuNiu.audioMgr.effBtnClick);\r\n    },\r\n    \r\n});\r\n"]}