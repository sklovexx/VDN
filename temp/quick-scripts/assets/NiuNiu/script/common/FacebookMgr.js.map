{"version":3,"sources":["FacebookMgr.js"],"names":["Facebook","require","FacebookMgr","cc","Class","ctor","facebook","inviteFriends","installFriends","_initSuccess","_onInviteFriendsCallback","_loginCallback","_loginFailCallback","_requestPicCallback","_requestNameCallback","_permissions","statics","instance","getInstance","initFacebook","facebookId","permissions","init","loginFacebook","successCallback","failCallback","isLoggedIn","log","login","requestInvitableFriends","logout","isLogin","getAccessToken","getUserID","inviteFriendsWithInviteIds","arr","title","text","callback","sys","isMobile","getInviteRequest","params","Object","api","requestUserPicture","requestUserName","fetchFriends","shareLink","link","image","_shareCallback","dialogLink","onLogin","msg","onGetUserInfo","userInfo","JSON","stringify","onInviteFriendsWithInviteIdsResult","result","onFetchFriends","ok","getInstallFriends","i","length","friend","uid","name","onRequestInvitableFriends","friends","data","onPermission","onSharedSuccess","onSharedFailed","onSharedCancel","onAPI","tag","parse","module","exports"],"mappings":"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","file":"FacebookMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\r\n * Created by skyxu on 2018/3/13.\r\n */\r\n\r\n\"use strict\";\r\n\r\nlet Facebook = require('./Facebook');\r\n\r\nlet FacebookMgr = cc.Class({\r\n\r\n    ctor: function () {\r\n\r\n        /**\r\n         * @type {Facebook}\r\n         */\r\n        this.facebook = new Facebook();\r\n\r\n        /**\r\n         * @type {array}\r\n         */\r\n        this.inviteFriends = [];\r\n\r\n        /**\r\n         * @type {array}\r\n         */\r\n        this.installFriends = [];\r\n\r\n        /**\r\n         * @type {boolean}\r\n         */\r\n        this._initSuccess = false;\r\n\r\n        /**\r\n         * @type {function} 邀请回调\r\n         */\r\n        this._onInviteFriendsCallback = null;\r\n        /**\r\n         * @type {function}\r\n         */\r\n        this._loginCallback = null;\r\n        /**\r\n         * @type {function}\r\n         */\r\n        this._loginFailCallback = null;\r\n\r\n        /**\r\n         *\r\n         * @type {function}\r\n         * @private\r\n         */\r\n        this._requestPicCallback = null;\r\n\r\n        this._requestNameCallback = null;\r\n\r\n        /**\r\n         * 权限数组\r\n         * @type {Array}\r\n         */\r\n        this._permissions = [];\r\n    },\r\n\r\n    statics: {\r\n        instance: null,\r\n        getInstance: function () {\r\n            if (FacebookMgr.instance == null){\r\n                FacebookMgr.instance = new FacebookMgr();\r\n            }\r\n            return FacebookMgr.instance;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param {string} facebookId\r\n     */\r\n    initFacebook: function (facebookId, permissions) {\r\n        this._initSuccess = this.facebook.init(this, facebookId);\r\n        this._permissions = permissions;\r\n    },\r\n\r\n    /**\r\n     * @param {string} facebookId\r\n     */\r\n    loginFacebook: function (facebookId, permissions, successCallback, failCallback) {\r\n        if(!this._initSuccess){\r\n            this.initFacebook(facebookId, permissions);\r\n            if(!this._initSuccess){\r\n                if(failCallback) failCallback();\r\n                return;\r\n            }\r\n        }\r\n\r\n        this._permissions = permissions;\r\n        this._loginCallback = successCallback;\r\n        this._loginFailCallback = failCallback;\r\n\r\n        if(!this.facebook.isLoggedIn()){\r\n            cc.log(\"FacebookMgr: to login\");\r\n            this.facebook.login(this._permissions);\r\n        }else{\r\n            cc.log(\"FacebookMgr: to requestInvitableFriends\");\r\n            this.facebook.requestInvitableFriends();\r\n            if(successCallback) successCallback();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 登出\r\n     */\r\n    logout: function () {\r\n        if(this.isLogin()){\r\n            this.facebook.logout();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @return {string}\r\n     */\r\n    getAccessToken: function () {\r\n        return this.facebook.getAccessToken();\r\n    },\r\n\r\n    /**\r\n     * @returns {*|string}\r\n     */\r\n    getUserID: function () {\r\n        return this.facebook.getUserID();\r\n    },\r\n\r\n    /**\r\n     * 邀请好友\r\n     * @param {Array} arr\r\n     * @param {string} title\r\n     * @param {string} text\r\n     * @param {function} callback\r\n     */\r\n    inviteFriendsWithInviteIds: function (arr, title, text, callback) {\r\n        if(cc.sys.isMobile){\r\n            this._onInviteFriendsCallback = callback;\r\n            this.facebook.inviteFriendsWithInviteIds(arr, title, text);\r\n        }else{\r\n            callback(true, null);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 获取要请请求\r\n     */\r\n    getInviteRequest: function () {\r\n        let params = new Object();\r\n        //params.fields = \"from\";\r\n        this.facebook.api(\"/me/apprequests\", \"GET\", params, \"apprequests\");\r\n    },\r\n\r\n    /**\r\n     * 获取邀请安装好友 onRequestInvitableFriends回调\r\n     */\r\n    requestInvitableFriends: function () {\r\n        let params = new Object();\r\n        this.facebook.api(\"/me/app_requests\", \"GET\", params, \"invitable_friends\");\r\n    },\r\n\r\n    /**\r\n     * 获取头像信息\r\n     * @param callback{function}\r\n     */\r\n    requestUserPicture: function (callback) {\r\n        this._requestPicCallback = callback;\r\n        this.facebook.requestUserPicture();\r\n    },\r\n\r\n    /**\r\n     * 获取用户名字\r\n     * @param callback\r\n     */\r\n    requestUserName: function (callback) {\r\n        this._requestNameCallback = callback;\r\n        this.facebook.requestUserName();\r\n    },\r\n\r\n    fetchFriends: function () {\r\n        if(this.isLogin()){\r\n            this.facebook.fetchFriends();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * share\r\n     * @param {string} link\r\n     * @param {string} title\r\n     * @param {string} text\r\n     * @param {string} image\r\n     */\r\n    shareLink: function (link, title, text, image, callback) {\r\n        if(this.isLogin()) {\r\n            this._shareCallback = callback;\r\n            this.facebook.dialogLink(link, title, text, image);\r\n        }\r\n    },\r\n\r\n    /*********************\r\n     * check\r\n     *********************/\r\n\r\n    /**\r\n     * @returns {boolean}\r\n     */\r\n    isLogin: function () {\r\n        return this._initSuccess && this.facebook.isLoggedIn();\r\n    },\r\n\r\n    /*********************\r\n     * Facebook callbacks\r\n     *********************/\r\n\r\n    onLogin: function(isLogin, msg) {\r\n        cc.log(\"onLogin\");\r\n        if(!isLogin){\r\n            cc.log(\"FacebookMgr: Facebook login fail  msg: \" + msg);\r\n            if(this._loginFailCallback) this._loginFailCallback();\r\n            return;\r\n        }\r\n        cc.log(\"FacebookMgr: Facebook had login\");\r\n        this.facebook.requestInvitableFriends();\r\n        if(this._loginCallback) this._loginCallback();\r\n    },\r\n\r\n    onGetUserInfo: function (userInfo) {\r\n        cc.log(\"onGetUserInfo: \" + JSON.stringify(userInfo));\r\n    },\r\n\r\n    onInviteFriendsWithInviteIdsResult: function(result, msg){\r\n        cc.log(\"FacebookMgr: onInviteFriendsWithInviteIdsResult \" + result + \"  \" + msg);\r\n        if(this._onInviteFriendsCallback){\r\n            let callback = this._onInviteFriendsCallback;\r\n            this._onInviteFriendsCallback = null;\r\n            callback(result, msg);\r\n        }\r\n    },\r\n\r\n    onFetchFriends: function(ok, msg) {\r\n        cc.log(\"FacebookMgr: onFetchFriends \" + ok);\r\n        this.installFriends = this.facebook.getInstallFriends();\r\n        cc.log(JSON.stringify(this.installFriends));\r\n        for (let i = 0; i < this.installFriends.length; i++) {\r\n            let friend = this.installFriends[i];\r\n            cc.log(\"-----------\");\r\n            cc.log(\">> uid=%s\", friend.uid);\r\n            cc.log(\">> name=%s\", friend.name);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param {Object} friends\r\n     */\r\n    onRequestInvitableFriends: function(friends) {\r\n        cc.log(\"FacebookMgr: onRequestInvitableFriends \" + friends);\r\n        this.inviteFriends = friends.data;\r\n        /*\r\n         for (let i = 0; i < this.inviteFriends.length; i++) {\r\n         let friend = this.inviteFriends[i];\r\n         cc.log(\"-----------\");\r\n         cc.log(\">> id=%s\", friend.id);\r\n         }\r\n         */\r\n    },\r\n\r\n    onPermission: function(isLogin, msg) {\r\n        cc.log(\"onPermission: \" + isLogin + \"   msg: \" + msg);\r\n    },\r\n\r\n    onSharedSuccess: function(data) {\r\n        cc.log(\"onSharedSuccess\");\r\n        if(this._shareCallback){\r\n            this._shareCallback();\r\n            this._shareCallback = null;\r\n        }\r\n    },\r\n\r\n    onSharedFailed: function(data) {\r\n        cc.log(\"onSharedFailed == \" + JSON.stringify(data));\r\n        if(this._shareCallback){\r\n            this._shareCallback = null;\r\n        }\r\n    },\r\n\r\n    onSharedCancel: function() {\r\n        cc.log(\"onSharedCancel\");\r\n        if(this._shareCallback){\r\n            this._shareCallback = null;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * @param {String} tag\r\n     * @param {String} data\r\n     */\r\n    onAPI: function(tag, data) {\r\n        cc.log(\"onAPI: \" + typeof data + \" | \" + data);\r\n        switch (tag){\r\n            case \"invitable_friends\":\r\n            {\r\n                //cc.log(\"invitable_friends : \" + data);\r\n                // this.inviteFriends = JSON.parse(data).data;\r\n                break;\r\n            }\r\n            case \"request_picture\":\r\n            {\r\n                if (this._requestPicCallback){\r\n                    cc.log(\"onAPI request_picture: \" + data);\r\n                    this._requestPicCallback(JSON.parse(data).data);\r\n                }\r\n                break;\r\n            }\r\n            case \"request_name\":{\r\n                cc.log(\"onAPI request_name: \" + data);\r\n                if (this._requestNameCallback){\r\n                    this._requestNameCallback(JSON.parse(data));\r\n                }\r\n            }\r\n        }\r\n    },\r\n\r\n});\r\n\r\nmodule.exports = FacebookMgr;"]}