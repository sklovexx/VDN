{"version":3,"sources":["FacebookMgr.js"],"names":["Facebook","require","FacebookMgr","cc","Class","ctor","facebook","inviteFriends","installFriends","_initSuccess","_onInviteFriendsCallback","_loginCallback","_loginFailCallback","_requestPicCallback","_requestNameCallback","_permissions","statics","instance","getInstance","initFacebook","facebookId","permissions","init","loginFacebook","successCallback","failCallback","isLoggedIn","log","login","requestInvitableFriends","logout","isLogin","getAccessToken","getUserID","inviteFriendsWithInviteIds","arr","title","text","callback","sys","isMobile","getInviteRequest","params","Object","api","requestUserPicture","requestUserName","fetchFriends","shareLink","link","image","_shareCallback","dialogLink","onLogin","msg","onGetUserInfo","userInfo","JSON","stringify","onInviteFriendsWithInviteIdsResult","result","onFetchFriends","ok","getInstallFriends","i","length","friend","uid","name","onRequestInvitableFriends","friends","data","onPermission","onSharedSuccess","onSharedFailed","onSharedCancel","onAPI","tag","parse","module","exports"],"mappings":"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","file":"FacebookMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\n * Created by skyxu on 2018/3/13.\n */\n\n\"use strict\";\n\nlet Facebook = require('./Facebook');\n\nlet FacebookMgr = cc.Class({\n\n    ctor: function () {\n\n        /**\n         * @type {Facebook}\n         */\n        this.facebook = new Facebook();\n\n        /**\n         * @type {array}\n         */\n        this.inviteFriends = [];\n\n        /**\n         * @type {array}\n         */\n        this.installFriends = [];\n\n        /**\n         * @type {boolean}\n         */\n        this._initSuccess = false;\n\n        /**\n         * @type {function} 邀请回调\n         */\n        this._onInviteFriendsCallback = null;\n        /**\n         * @type {function}\n         */\n        this._loginCallback = null;\n        /**\n         * @type {function}\n         */\n        this._loginFailCallback = null;\n\n        /**\n         *\n         * @type {function}\n         * @private\n         */\n        this._requestPicCallback = null;\n\n        this._requestNameCallback = null;\n\n        /**\n         * 权限数组\n         * @type {Array}\n         */\n        this._permissions = [];\n    },\n\n    statics: {\n        instance: null,\n        getInstance: function () {\n            if (FacebookMgr.instance == null){\n                FacebookMgr.instance = new FacebookMgr();\n            }\n            return FacebookMgr.instance;\n        }\n    },\n\n    /**\n     * @param {string} facebookId\n     */\n    initFacebook: function (facebookId, permissions) {\n        this._initSuccess = this.facebook.init(this, facebookId);\n        this._permissions = permissions;\n    },\n\n    /**\n     * @param {string} facebookId\n     */\n    loginFacebook: function (facebookId, permissions, successCallback, failCallback) {\n        if(!this._initSuccess){\n            this.initFacebook(facebookId, permissions);\n            if(!this._initSuccess){\n                if(failCallback) failCallback();\n                return;\n            }\n        }\n\n        this._permissions = permissions;\n        this._loginCallback = successCallback;\n        this._loginFailCallback = failCallback;\n\n        if(!this.facebook.isLoggedIn()){\n            cc.log(\"FacebookMgr: to login\");\n            this.facebook.login(this._permissions);\n        }else{\n            cc.log(\"FacebookMgr: to requestInvitableFriends\");\n            this.facebook.requestInvitableFriends();\n            if(successCallback) successCallback();\n        }\n    },\n\n    /**\n     * 登出\n     */\n    logout: function () {\n        if(this.isLogin()){\n            this.facebook.logout();\n        }\n    },\n\n    /**\n     * @return {string}\n     */\n    getAccessToken: function () {\n        return this.facebook.getAccessToken();\n    },\n\n    /**\n     * @returns {*|string}\n     */\n    getUserID: function () {\n        return this.facebook.getUserID();\n    },\n\n    /**\n     * 邀请好友\n     * @param {Array} arr\n     * @param {string} title\n     * @param {string} text\n     * @param {function} callback\n     */\n    inviteFriendsWithInviteIds: function (arr, title, text, callback) {\n        if(cc.sys.isMobile){\n            this._onInviteFriendsCallback = callback;\n            this.facebook.inviteFriendsWithInviteIds(arr, title, text);\n        }else{\n            callback(true, null);\n        }\n    },\n\n    /**\n     * 获取要请请求\n     */\n    getInviteRequest: function () {\n        let params = new Object();\n        //params.fields = \"from\";\n        this.facebook.api(\"/me/apprequests\", \"GET\", params, \"apprequests\");\n    },\n\n    /**\n     * 获取邀请安装好友 onRequestInvitableFriends回调\n     */\n    requestInvitableFriends: function () {\n        let params = new Object();\n        this.facebook.api(\"/me/app_requests\", \"GET\", params, \"invitable_friends\");\n    },\n\n    /**\n     * 获取头像信息\n     * @param callback{function}\n     */\n    requestUserPicture: function (callback) {\n        this._requestPicCallback = callback;\n        this.facebook.requestUserPicture();\n    },\n\n    /**\n     * 获取用户名字\n     * @param callback\n     */\n    requestUserName: function (callback) {\n        this._requestNameCallback = callback;\n        this.facebook.requestUserName();\n    },\n\n    fetchFriends: function () {\n        if(this.isLogin()){\n            this.facebook.fetchFriends();\n        }\n    },\n\n    /**\n     * share\n     * @param {string} link\n     * @param {string} title\n     * @param {string} text\n     * @param {string} image\n     */\n    shareLink: function (link, title, text, image, callback) {\n        if(this.isLogin()) {\n            this._shareCallback = callback;\n            this.facebook.dialogLink(link, title, text, image);\n        }\n    },\n\n    /*********************\n     * check\n     *********************/\n\n    /**\n     * @returns {boolean}\n     */\n    isLogin: function () {\n        return this._initSuccess && this.facebook.isLoggedIn();\n    },\n\n    /*********************\n     * Facebook callbacks\n     *********************/\n\n    onLogin: function(isLogin, msg) {\n        cc.log(\"onLogin\");\n        if(!isLogin){\n            cc.log(\"FacebookMgr: Facebook login fail  msg: \" + msg);\n            if(this._loginFailCallback) this._loginFailCallback();\n            return;\n        }\n        cc.log(\"FacebookMgr: Facebook had login\");\n        this.facebook.requestInvitableFriends();\n        if(this._loginCallback) this._loginCallback();\n    },\n\n    onGetUserInfo: function (userInfo) {\n        cc.log(\"onGetUserInfo: \" + JSON.stringify(userInfo));\n    },\n\n    onInviteFriendsWithInviteIdsResult: function(result, msg){\n        cc.log(\"FacebookMgr: onInviteFriendsWithInviteIdsResult \" + result + \"  \" + msg);\n        if(this._onInviteFriendsCallback){\n            let callback = this._onInviteFriendsCallback;\n            this._onInviteFriendsCallback = null;\n            callback(result, msg);\n        }\n    },\n\n    onFetchFriends: function(ok, msg) {\n        cc.log(\"FacebookMgr: onFetchFriends \" + ok);\n        this.installFriends = this.facebook.getInstallFriends();\n        cc.log(JSON.stringify(this.installFriends));\n        for (let i = 0; i < this.installFriends.length; i++) {\n            let friend = this.installFriends[i];\n            cc.log(\"-----------\");\n            cc.log(\">> uid=%s\", friend.uid);\n            cc.log(\">> name=%s\", friend.name);\n        }\n    },\n\n    /**\n     * @param {Object} friends\n     */\n    onRequestInvitableFriends: function(friends) {\n        cc.log(\"FacebookMgr: onRequestInvitableFriends \" + friends);\n        this.inviteFriends = friends.data;\n        /*\n         for (let i = 0; i < this.inviteFriends.length; i++) {\n         let friend = this.inviteFriends[i];\n         cc.log(\"-----------\");\n         cc.log(\">> id=%s\", friend.id);\n         }\n         */\n    },\n\n    onPermission: function(isLogin, msg) {\n        cc.log(\"onPermission: \" + isLogin + \"   msg: \" + msg);\n    },\n\n    onSharedSuccess: function(data) {\n        cc.log(\"onSharedSuccess\");\n        if(this._shareCallback){\n            this._shareCallback();\n            this._shareCallback = null;\n        }\n    },\n\n    onSharedFailed: function(data) {\n        cc.log(\"onSharedFailed == \" + JSON.stringify(data));\n        if(this._shareCallback){\n            this._shareCallback = null;\n        }\n    },\n\n    onSharedCancel: function() {\n        cc.log(\"onSharedCancel\");\n        if(this._shareCallback){\n            this._shareCallback = null;\n        }\n    },\n\n    /**\n     * @param {String} tag\n     * @param {String} data\n     */\n    onAPI: function(tag, data) {\n        cc.log(\"onAPI: \" + typeof data + \" | \" + data);\n        switch (tag){\n            case \"invitable_friends\":\n            {\n                //cc.log(\"invitable_friends : \" + data);\n                // this.inviteFriends = JSON.parse(data).data;\n                break;\n            }\n            case \"request_picture\":\n            {\n                if (this._requestPicCallback){\n                    cc.log(\"onAPI request_picture: \" + data);\n                    this._requestPicCallback(JSON.parse(data).data);\n                }\n                break;\n            }\n            case \"request_name\":{\n                cc.log(\"onAPI request_name: \" + data);\n                if (this._requestNameCallback){\n                    this._requestNameCallback(JSON.parse(data));\n                }\n            }\n        }\n    },\n\n});\n\nmodule.exports = FacebookMgr;"]}