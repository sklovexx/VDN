{"version":3,"sources":["IAPMgr.js"],"names":["IAP","require","Utils","IAPMgr","cc","Class","ctor","iap","_initSuccess","statics","instance","getInstance","initIAP","isDebug","log","init","pay","name","restore","savePurchaseSuccessProductInfo","id","receipt","onInitialized","res","onSuccess","product","JSON","stringify","obj","productId","vender","receiptCipheredPayload","IapTools","onBuySuc","onFailure","msg","onBuyFailed","onCanceled","onRestored","onRestoreComplete","ok","onRestoreFinished","onProductRequestSuccess","products","onProductRequestFailure","module","exports"],"mappings":"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","file":"IAPMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\r\n * Created by skyxu on 2018/3/13.\r\n */\r\n\r\n\"use strict\";\r\n\r\nlet IAP = require('./IAP');\r\nlet Utils = require('./UtilsOther');\r\n\r\nlet IAPMgr = cc.Class({\r\n\r\n    ctor: function () {\r\n\r\n        /**\r\n         * @type {IAP}\r\n         */\r\n        this.iap = new IAP();\r\n\r\n        /**\r\n         * @type {boolean}\r\n         */\r\n        this._initSuccess = false;\r\n    },\r\n\r\n    statics: {\r\n        instance: null,\r\n        getInstance: function () {\r\n            if (IAPMgr.instance == null){\r\n                IAPMgr.instance = new IAPMgr();\r\n            }\r\n            return IAPMgr.instance;\r\n        }\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param isDebug{Boolean} 是否调试模式\r\n     */\r\n    initIAP: function (isDebug) {\r\n        cc.log(\"init iap\");\r\n        this._initSuccess = this.iap.init(this, isDebug);\r\n    },\r\n\r\n    /**\r\n     * @param {string} name sdkbox_config.json对应的key\r\n     */\r\n    pay: function (name) {\r\n        if(this._initSuccess){\r\n            cc.log(' 购买的商品id：' + name);\r\n            this.iap.pay(name);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 恢复购买\r\n     */\r\n    restore: function () {\r\n        if (this._initSuccess){\r\n            cc.log(\"IAPMgr restore\");\r\n            this.iap.restore();\r\n        }\r\n    },\r\n\r\n    /**\r\n     * 购买保护\r\n     */\r\n    savePurchaseSuccessProductInfo: function (id, receipt) {\r\n\r\n        // farm.localStorage.setItem()\r\n    },\r\n\r\n    /*********************\r\n     * IAP callbacks\r\n     *********************/\r\n    onInitialized: function (res) {\r\n        cc.log(\"sdkbox iap init: \" + res);\r\n    },\r\n\r\n    onSuccess : function (product) {\r\n        // cc.log(\"FarmIAPMgr: onSuccess \" + product);\r\n        cc.log(\"IAPMgr store onSuccess = \" + JSON.stringify(product));\r\n\r\n        //\r\n        // farm.viewManager.popLoading();\r\n\r\n        let obj = {};\r\n        obj.productId = product.name;\r\n        obj.vender = \"APPLE\";\r\n        obj.receipt = product.receiptCipheredPayload;\r\n        // farm.game.serverproxy.getPurchaseSucessfullyInfo(obj);\r\n        cc.log(\"buy success------------1\");\r\n        cc.log(\"product.name:\" + product.name);\r\n        IapTools.onBuySuc(product.name);\r\n        cc.log(\"buy success------------2\");\r\n\r\n    },\r\n    onFailure : function (product, msg) {\r\n        // cc.log(\"FarmIAPMgr: onFailure \" + product + \"  msg: \" + msg);\r\n        cc.log(\"IAPMgr store onFailure = \" + JSON.stringify(product) + \" ===   msg: \" + msg);\r\n\r\n        // farm.viewManager.popLoading();\r\n\r\n        cc.log(\"buy failed------------1\");\r\n        cc.log(\"product.name:\" + product.name);\r\n        IapTools.onBuyFailed(msg);\r\n        cc.log(\"buy failed------------2\");\r\n    },\r\n    onCanceled : function (product) {\r\n        // cc.log(\"FarmIAPMgr: onCanceled \" + product);\r\n        // farm.viewManager.popLoading();\r\n    },\r\n    onRestored : function (product) {\r\n        cc.log(\"IAPMgr: onRestored \" + JSON.stringify(product));\r\n        // farm.viewManager.popLoading();\r\n    },\r\n\r\n    onRestoreComplete(ok, msg){\r\n        cc.log(\"IAPMgr: onRestored Complete \" + ok + \", \" + msg);\r\n\r\n        IapTools.onRestoreFinished(ok, msg);\r\n    },\r\n\r\n    onProductRequestSuccess : function (products) {\r\n        //Returns you the data for all the iap products\r\n        //You can get each item using following method\r\n        //products\r\n\r\n        cc.log(\"IAPMgr store onProductRequestSuccess = \" + JSON.stringify(products));\r\n        // let obj = {\r\n        //     \"name\":\"coin_package\",\r\n        //     \"id\":\"com.cocos2dx.plugintest2\",\r\n        //     \"title\":\"\",\r\n        //     \"description\":\"\",\r\n        //     \"price\":\"\",\"currencyCode\":\"\",\r\n        //     \"receipt\":\"\",\r\n        //     \"receiptCipheredPayload\":\"\"\r\n        // }\r\n\r\n        // let obj = {};\r\n        // obj.productId = product.name;\r\n        // obj.vender = \"APPLE\";\r\n        // obj.receipt = product.receiptCipheredPayload;\r\n        // farm.game.serverproxy.getPurchaseSucessfullyInfo(obj);\r\n\r\n        // for (let i = 0; i < products.length; i++) {\r\n        //     // loop\r\n        //     cc.log(\"FarmIAPMgr: onProductRequestSuccess \" + i + \": \" + JSON.stringify(products[i]));\r\n        // }\r\n    },\r\n    onProductRequestFailure : function (msg) {\r\n        cc.log(\"IAPMgr: onProductRequestFailure \" + msg);\r\n    }\r\n});\r\n\r\n\r\nmodule.exports = IAPMgr;"]}