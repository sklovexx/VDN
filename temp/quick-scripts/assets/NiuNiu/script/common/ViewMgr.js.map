{"version":3,"sources":["ViewMgr.js"],"names":["GCONFIG","require","ViewMgr","cc","Class","ctor","_views","rootNode","_isShowing","loading","GlobalNiuNiu","eventMgr","on","EVENT_CHANGE_SCENE","beforeChangeScene","statics","_instance","getInstance","log","removeAllView","pushView","view","noMask","immediatelyHandle","_pushViewAndInit","getComponent","_owner","push","_sortView","_showNextView","viewBase","assert","root","Canvas","instance","node","Node","width","height","zIndex","LOCAL_ZINDEX_MAX","addChild","mask","active","undefined","pushViewImmediate","showWithAni","onViewDestroy","length","shift","i","destroy","parent","module","exports"],"mappings":"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","file":"ViewMgr.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\n * Created by skyxu on 2018/3/27.\n */\n\n\"use strict\";\n\nlet GCONFIG = require(\"./GCONFIG\");\n\nlet ViewMgr = cc.Class({\n\n    ctor: function() {\n\n        /**\n         *\n         * @type {Array.<View>}\n         * @private\n         */\n        this._views = [];\n\n        this.rootNode = null;\n\n        this._isShowing = false;    // 标记当前有view正在显示\n\n        /**\n         * @type {cc.Node}\n         */\n        this.loading = null;\n\n        GlobalNiuNiu.eventMgr.on(GCONFIG.EVENT_CHANGE_SCENE, function () {\n            this.beforeChangeScene();\n        }, this);\n    },\n\n    statics:{\n        _instance: null,\n        getInstance(){\n            if (!ViewMgr._instance){\n                ViewMgr._instance = new ViewMgr();\n            }\n            return ViewMgr._instance;\n        }\n    },\n\n    /**\n     * 切换场景之前要调用一下，用来移除所有没有移除的view\n     */\n    beforeChangeScene(){\n        cc.log(\"---before change scene.\");\n        this.removeAllView();\n    },\n\n    /**\n     * 显示视图\n     * @param {cc.Node} view inherit ViewBase\n     * @param {Boolean} noMask\n     * @param {Boolean} immediatelyHandle 是否立即开始调用回掉函数\n     */\n    pushView: function(view, noMask, immediatelyHandle) {\n        this._pushViewAndInit(view, noMask, immediatelyHandle);\n        view.getComponent(\"ViewBase\")._owner = this;\n        this._views.push(view);\n        this._sortView();\n        this._showNextView();\n    },\n\n    _pushViewAndInit(view, noMask, immediatelyHandle){\n        let viewBase = view.getComponent(\"ViewBase\");\n        cc.assert(viewBase, \"view must has component ViewBase or inherit ViewBase.\");\n\n        if (!this.rootNode){\n            let root = cc.Canvas.instance.node;\n            this.rootNode = new cc.Node;\n            this.rootNode.width = root.width;\n            this.rootNode.height = root.height;\n            this.rootNode.zIndex = GCONFIG.LOCAL_ZINDEX_MAX;\n            root.addChild(this.rootNode);\n        }\n\n        if(noMask && viewBase.mask){\n            viewBase.mask.active = false;\n        }\n        viewBase.immediatelyHandle = immediatelyHandle !== undefined?immediatelyHandle:false;\n\n    },\n\n    // 独立于队列，直接显示\n    pushViewImmediate(view, noMask, immediatelyHandle){\n        this._pushViewAndInit(view, noMask, immediatelyHandle);\n        view.getComponent(\"ViewBase\").showWithAni();\n        this.rootNode.addChild(view);\n    },\n\n    onViewDestroy(){\n        this._isShowing = false;\n        this._showNextView();\n    },\n\n    _sortView(){\n        // todo:  可以对队列里的view按照某个顺序进行排序\n    },\n\n    _showNextView(){\n        if (this._isShowing){\n            return;\n        }\n\n        if (this._views.length < 0){\n            return;\n        }\n\n        let view = this._views.shift();\n\n        if (view){\n            view.getComponent(\"ViewBase\").showWithAni();\n            this.rootNode.addChild(view);\n            this._isShowing = true;\n        } else {\n            this._isShowing = false;\n        }\n    },\n\n    removeAllView: function() {\n        for(let i = 0; i < this._views.length; i++){\n            let view = this._views[i];\n            view.destroy();\n        }\n        if (this.loading){\n            this.loading.parent = null;\n            this.loading.destroy();\n            this.loading = null;\n        }\n        if (this.rootNode){\n            this.rootNode.parent = null;\n            this.rootNode.destroy();\n            this.rootNode = null;\n        }\n        this._views = [];\n        this._isShowing = false;\n    }\n});\n\nmodule.exports = ViewMgr;"]}