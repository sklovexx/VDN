{"version":3,"sources":["LabelInteger.js"],"names":["UtilsOther","require","LabelFormType","cc","Enum","None","ThousandSeparator","FormatTime","formatTime","s","t","hour","Math","floor","min","sec","day","parseInt","slice","Class","extends","Label","properties","formType","tooltip","type","default","notify","oldValue","setValue","string","animationDuration","_textKey","override","get","set","value","Number","_sgNode","toString","split","reverse","join","replace","setString","_updateNodeSize","_curValue","_toValue","_delta","animate","isNaN","assert","setFormString","update","dt","step","max","onLoad"],"mappings":"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","file":"LabelInteger.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\NiuNiu\\script\\common","sourcesContent":["/**\r\n * Created by skyxu on 2018/3/13.\r\n * 专门用来显示数字的Label，实现滚动效果\r\n */\r\n\r\n\"use strict\";\r\n\r\nlet UtilsOther = require('UtilsOther');\r\n\r\nlet LabelFormType = cc.Enum({\r\n    None: 0, // 不做格式化\r\n    ThousandSeparator: 1, // 3位分隔\r\n    FormatTime: 2 // 格式化时间\r\n});\r\n\r\n/**\r\n *\r\n * @param s {Number} 秒\r\n * @return {string}\r\n */\r\nlet formatTime = function (s) {\r\n    let t;\r\n    if (s >= 0) {\r\n        let hour = Math.floor(s / 3600);\r\n        let min = Math.floor(s / 60) % 60;\r\n        let sec = s % 60;\r\n        let day = parseInt(hour / 24);\r\n        if (day == 1) {\r\n            return day + \" day\";\r\n        }\r\n        if (day > 1) {\r\n            return day + \" days\";\r\n        }\r\n\r\n        if (day > 0) {\r\n            hour = hour - 24 * day;\r\n            t = day + \"day \" + ('00' + hour).slice(-2) + \":\";\r\n        }\r\n        else if (hour > 0) {\r\n            t = ('00' + hour).slice(-2) + \":\";\r\n        } else {\r\n            t = \"\";\r\n        }\r\n\r\n        if (min < 10) {\r\n            t += \"0\";\r\n        }\r\n        t += min + \":\";\r\n        if (sec < 10) {\r\n            t += \"0\";\r\n        }\r\n        t += parseInt(sec);\r\n    }\r\n    return t;\r\n};\r\n\r\ncc.Class({\r\n    extends: cc.Label,\r\n\r\n    properties: {\r\n        formType: {\r\n            tooltip: 'None: 不做格式化\\nThousandSeparator: 3位逗号分隔\\nFormatTime: 格式化时间',\r\n            type: LabelFormType,\r\n            default: LabelFormType.None,\r\n            notify: function(oldValue){\r\n                this.setValue(this.string);\r\n            }\r\n        },\r\n\r\n        animationDuration: {\r\n            tooltip: '动画时间',\r\n            default: 0.5\r\n        },\r\n\r\n        /**\r\n         * label的实际数值\r\n         */\r\n        _textKey: 0,\r\n\r\n        string: {\r\n            override: true,\r\n            tooltip: '必须是数字',\r\n            get: function () {\r\n                return this._textKey;\r\n            },\r\n            set: function (value) {\r\n                // 编辑器输入默认是字符串，这里必须转成数字方便计算\r\n                this._textKey = Number(value);\r\n                if (this._sgNode) {\r\n                    switch(this.formType){\r\n                        case LabelFormType.ThousandSeparator:\r\n                        {\r\n                            value = value.toString().split('').reverse().join('').replace(/(\\d{3}(?=\\d)(?!\\d+\\.|$))/g, '$1,').split('').reverse().join('');\r\n                        }\r\n                            break;\r\n                        case LabelFormType.FormatTime:\r\n                        {\r\n                            value = formatTime(value);\r\n                        }\r\n                            break;\r\n                    }\r\n                    this._sgNode.setString(value);\r\n                    this._updateNodeSize();\r\n                }\r\n            }\r\n        },\r\n\r\n        _curValue: 0,\r\n        _toValue: 0,\r\n        _delta: 0\r\n    },\r\n\r\n    /**\r\n     * 设置数值\r\n     * @param {int} value\r\n     * @param {boolean} animate 是否动画\r\n     */\r\n    setValue: function (value, animate) {\r\n        if (value === \"\" || value === null || isNaN(value)){\r\n            cc.assert(false, \"The value of LabelInteger must be a Number!\");\r\n        }\r\n\r\n        if(animate){\r\n            this._toValue = value;\r\n        }\r\n        else{\r\n            this._toValue = value;\r\n            this._curValue = value;\r\n            this.string = value;\r\n            //this.setFormString(value.toString());\r\n        }\r\n        this._delta = 0;\r\n    },\r\n\r\n    setFormString: function(value){\r\n        switch(this.formType){\r\n            case LabelFormType.None:\r\n            {\r\n                this.string = value;\r\n            }\r\n                break;\r\n            case LabelFormType.ThousandSeparator:\r\n            {\r\n                this.string = value.split('').reverse().join('').replace(/(\\d{3}(?=\\d)(?!\\d+\\.|$))/g, '$1,').split('').reverse().join('');\r\n            }\r\n                break;\r\n            case LabelFormType.FormatTime:\r\n            {\r\n                this.string = formatTime(value);\r\n            }\r\n                break;\r\n        }\r\n    },\r\n\r\n    update: function (dt) {\r\n        if(this._toValue != this._curValue){\r\n            if(this._delta == 0){\r\n                this._delta = this._toValue - this._curValue;\r\n            }\r\n            let step = dt / this.animationDuration * this._delta;\r\n            if(this._delta > 0){\r\n                step = parseInt(step);\r\n                if(step == 0){\r\n                    step = 1;\r\n                }\r\n                this._curValue += step;\r\n                this._curValue = Math.min(this._curValue, this._toValue);\r\n            }\r\n            else{\r\n                step = -step;\r\n                step = parseInt(step);\r\n                if(step == 0){\r\n                    step = 1;\r\n                }\r\n                this._curValue -= step;\r\n                this._curValue = Math.max(this._curValue, this._toValue);\r\n            }\r\n            this.string = this._curValue;\r\n            //this.setFormString(this._curValue.toString());\r\n\r\n            if(this._toValue == this._curValue){\r\n                this._delta = 0;\r\n            }\r\n        }\r\n    },\r\n\r\n    onLoad: function(){\r\n        // 为了初始就显示正确的格式\r\n        this.setValue(this.string);\r\n    }\r\n});\r\n"]}